(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["5ba2fa61"],{"21a6":function(t,e,i){(function(i){var n,s,o;(function(i,r){s=[],n=r,o="function"===typeof n?n.apply(e,s):n,void 0===o||(t.exports=o)})(0,(function(){"use strict";function e(t,e){return"undefined"==typeof e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}function n(t,e,i){var n=new XMLHttpRequest;n.open("GET",t),n.responseType="blob",n.onload=function(){a(n.response,e,i)},n.onerror=function(){console.error("could not download file")},n.send()}function s(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&299>=e.status}function o(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(n){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var r="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof i&&i.global===i?i:void 0,a=r.saveAs||("object"!=typeof window||window!==r?function(){}:"download"in HTMLAnchorElement.prototype?function(t,e,i){var a=r.URL||r.webkitURL,l=document.createElement("a");e=e||t.name||"download",l.download=e,l.rel="noopener","string"==typeof t?(l.href=t,l.origin===location.origin?o(l):s(l.href)?n(t,e,i):o(l,l.target="_blank")):(l.href=a.createObjectURL(t),setTimeout((function(){a.revokeObjectURL(l.href)}),4e4),setTimeout((function(){o(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(t,i,r){if(i=i||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(e(t,r),i);else if(s(t))n(t,i,r);else{var a=document.createElement("a");a.href=t,a.target="_blank",setTimeout((function(){o(a)}))}}:function(t,e,i,s){if(s=s||open("","_blank"),s&&(s.document.title=s.document.body.innerText="downloading..."),"string"==typeof t)return n(t,e,i);var o="application/octet-stream"===t.type,a=/constructor/i.test(r.HTMLElement)||r.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||o&&a)&&"object"==typeof FileReader){var u=new FileReader;u.onloadend=function(){var t=u.result;t=l?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),s?s.location.href=t:location=t,s=null},u.readAsDataURL(t)}else{var h=r.URL||r.webkitURL,p=h.createObjectURL(t);s?s.location=p:location.href=p,s=null,setTimeout((function(){h.revokeObjectURL(p)}),4e4)}});r.saveAs=a.saveAs=a,t.exports=a}))}).call(this,i("c8ba"))},"6e14":function(module,exports,__webpack_require__){(function(process){(function(t){var e=t.LiteGraph={VERSION:.4,CANVAS_GRID_SIZE:10,NODE_TITLE_HEIGHT:30,NODE_TITLE_TEXT_Y:20,NODE_SLOT_HEIGHT:20,NODE_WIDGET_HEIGHT:20,NODE_WIDTH:170,NODE_MIN_WIDTH:50,NODE_COLLAPSED_RADIUS:10,NODE_COLLAPSED_WIDTH:80,NODE_TITLE_COLOR:"#e6f4eb",NODE_TEXT_SIZE:14,NODE_TEXT_COLOR:"rgba(35,35,35,0.99)",NODE_SUBTEXT_SIZE:12,NODE_DEFAULT_COLOR:"#f4511e",NODE_DEFAULT_BGCOLOR:"rgba(255,236,201,0.52)",NODE_DEFAULT_BOXCOLOR:"rgba(255,236,201,0.52)",NODE_DEFAULT_SHAPE:"box",DEFAULT_SHADOW_COLOR:"rgba(0,0,0,0.5)",DEFAULT_GROUP_FONT:24,WIDGET_BGCOLOR:"#222",WIDGET_OUTLINE_COLOR:"#666",WIDGET_TEXT_COLOR:"#DDD",WIDGET_SECONDARY_TEXT_COLOR:"#999",LINK_COLOR:"#9A9",EVENT_LINK_COLOR:"#A86",CONNECTING_LINK_COLOR:"#AFA",MAX_NUMBER_OF_NODES:1e3,DEFAULT_POSITION:[100,100],VALID_SHAPES:["default","box","round","card"],BOX_SHAPE:1,ROUND_SHAPE:2,CIRCLE_SHAPE:3,CARD_SHAPE:4,ARROW_SHAPE:5,INPUT:1,OUTPUT:2,EVENT:-1,ACTION:-1,ALWAYS:0,ON_EVENT:1,NEVER:2,ON_TRIGGER:3,UP:1,DOWN:2,LEFT:3,RIGHT:4,CENTER:5,STRAIGHT_LINK:0,LINEAR_LINK:1,SPLINE_LINK:2,NORMAL_TITLE:0,NO_TITLE:1,TRANSPARENT_TITLE:2,AUTOHIDE_TITLE:3,proxy:null,node_images_path:"",debug:!1,catch_exceptions:!0,throw_errors:!0,allow_scripts:!1,registered_node_types:{},node_types_by_file_extension:{},Nodes:{},searchbox_extras:{},registerNodeType:function(t,i){if(!i.prototype)throw"Cannot register a simple object, it must be a class with a prototype";i.type=t,e.debug&&console.log("Node registered: "+t);t.split("/");var n=i.name,o=t.lastIndexOf("/");if(i.category=t.substr(0,o),i.title||(i.title=n),i.prototype)for(var r in s.prototype)i.prototype[r]||(i.prototype[r]=s.prototype[r]);Object.hasOwnProperty(i.prototype,"shape")||Object.defineProperty(i.prototype,"shape",{set:function(t){switch(t){case"default":delete this._shape;break;case"box":this._shape=e.BOX_SHAPE;break;case"round":this._shape=e.ROUND_SHAPE;break;case"circle":this._shape=e.CIRCLE_SHAPE;break;case"card":this._shape=e.CARD_SHAPE;break;default:this._shape=t}},get:function(t){return this._shape},enumerable:!0});var a=this.registered_node_types[t];if(a&&console.log("replacing node type: "+t),this.registered_node_types[t]=i,i.constructor.name&&(this.Nodes[n]=i),e.onNodeTypeRegistered&&e.onNodeTypeRegistered(t,i),a&&e.onNodeTypeReplaced&&e.onNodeTypeReplaced(t,i,a),i.prototype.onPropertyChange&&console.warn("LiteGraph node class "+t+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),i.supported_extensions)for(var r in i.supported_extensions)this.node_types_by_file_extension[i.supported_extensions[r].toLowerCase()]=i},wrapFunctionAsNode:function(t,i,n,s,o){for(var r=Array(i.length),a="",l=e.getParameterNames(i),u=0;u<l.length;++u)a+="this.addInput('"+l[u]+"',"+(n&&n[u]?"'"+n[u]+"'":"0")+");\n";a+="this.addOutput('out',"+(s?"'"+s+"'":0)+");\n",o&&(a+="this.properties = "+JSON.stringify(o)+";\n");var h=Function(a);h.title=t.split("/").pop(),h.desc="Generated from "+i.name,h.prototype.onExecute=function(){for(var t=0;t<r.length;++t)r[t]=this.getInputData(t);var e=i.apply(this,r);this.setOutputData(0,e)},this.registerNodeType(t,h)},addNodeMethod:function(t,e){for(var i in s.prototype[t]=e,this.registered_node_types){var n=this.registered_node_types[i];n.prototype[t]&&(n.prototype["_"+t]=n.prototype[t]),n.prototype[t]=e}},createNode:function(t,i,n){var s=this.registered_node_types[t];if(!s)return e.debug&&console.log('GraphNode type "'+t+'" not registered.'),null;s.prototype;i=i||s.title||t;var o=null;if(e.catch_exceptions)try{o=new s(i)}catch(a){return console.error(a),null}else o=new s(i);if(o.type=t,!o.title&&i&&(o.title=i),o.properties||(o.properties={}),o.properties_info||(o.properties_info=[]),o.flags||(o.flags={}),o.size||(o.size=o.computeSize()),o.pos||(o.pos=e.DEFAULT_POSITION.concat()),o.mode||(o.mode=e.ALWAYS),n)for(var r in n)o[r]=n[r];return o},getNodeType:function(t){return this.registered_node_types[t]},getNodeTypesInCategory:function(t,e){var i=[];for(var n in this.registered_node_types){var s=this.registered_node_types[n];e&&s.filter&&s.filter!=e||(""==t?null==s.category&&i.push(s):s.category==t&&i.push(s))}return i},getNodeTypesCategories:function(t){var e={"":1};for(var i in this.registered_node_types){var n=this.registered_node_types[i];if(n.category&&!n.skip_list){if(t&&n.filter!=t)continue;e[n.category]=1}}var s=[];for(var i in e)s.push(i);return s},reloadNodes:function(t){var i=document.getElementsByTagName("script"),n=[];for(var s in i)n.push(i[s]);var o=document.getElementsByTagName("head")[0];for(var s in t=document.location.href+t,n){var r=n[s].src;if(r&&r.substr(0,t.length)==t)try{e.debug&&console.log("Reloading: "+r);var a=document.createElement("script");a.type="text/javascript",a.src=r,o.appendChild(a),o.removeChild(n[s])}catch(l){if(e.throw_errors)throw l;e.debug&&console.log("Error while reloading "+r)}}e.debug&&console.log("Nodes reloaded")},cloneObject:function(t,e){if(null==t)return null;var i=JSON.parse(JSON.stringify(t));if(!e)return i;for(var n in i)e[n]=i[n];return e},isValidConnection:function(t,i){if(!t||!i||t==i||t==e.EVENT&&i==e.ACTION)return!0;if(t=String(t),i=String(i),t=t.toLowerCase(),i=i.toLowerCase(),-1==t.indexOf(",")&&-1==i.indexOf(","))return t==i;for(var n=t.split(","),s=i.split(","),o=0;o<n.length;++o)for(var r=0;r<s.length;++r)if(n[o]==s[r])return!0;return!1},registerSearchboxExtra:function(t,e,i){this.searchbox_extras[e.toLowerCase()]={type:t,desc:e,data:i}}};function i(t){e.debug&&console.log("Graph created"),this.list_of_graphcanvas=null,this.clear(),t&&this.configure(t)}function n(t,e,i,n,s,o){this.id=t,this.type=e,this.origin_id=i,this.origin_slot=n,this.target_id=s,this.target_slot=o,this._data=null,this._pos=new Float32Array(2)}function s(t){this._ctor(t)}function o(t){this._ctor(t)}function r(t,e){this.offset=new Float32Array([0,0]),this.scale=1,this.max_scale=10,this.min_scale=.1,this.onredraw=null,this.enabled=!0,this.last_mouse=[0,0],this.element=null,this.visible_area=new Float32Array(4),t&&(this.element=t,e||this.bindEvents(t))}function a(t,i,n){n=n||{},this.background_image="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=",t&&t.constructor===String&&(t=document.querySelector(t)),this.ds=new r,this.zoom_modify_alpha=!0,this.title_text_font=e.NODE_TEXT_SIZE+"px Arial",this.inner_text_font="normal "+e.NODE_SUBTEXT_SIZE+"px Arial",this.node_title_color=e.NODE_TITLE_COLOR,this.default_link_color=e.LINK_COLOR,this.default_connection_color={input_off:"#778",input_on:"#7F7",output_off:"#778",output_on:"#7F7"},this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.clear_background=!0,this.read_only=!1,this.render_only_selected=!0,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.allow_searchbox=!0,this.allow_reconnect_links=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.always_render_background=!1,this.render_shadows=!0,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!1,this.render_connection_arrows=!1,this.render_collapsed_slots=!0,this.render_execution_order=!1,this.render_title_colored=!0,this.render_link_tooltip=!0,this.links_render_mode=e.SPLINE_LINK,this.canvas_mouse=[0,0],this.onSearchBox=null,this.onSearchBoxSelection=null,this.onMouse=null,this.onDrawBackground=null,this.onDrawForeground=null,this.onDrawOverlay=null,this.onDrawLinkTooltip=null,this.connections_width=3,this.round_radius=8,this.current_node=null,this.node_widget=null,this.over_link_center=null,this.last_mouse_position=[0,0],this.visible_area=this.ds.visible_area,this.visible_links=[],i&&i.attachCanvas(this),this.setCanvas(t),this.clear(),n.skip_render||this.startRendering(),this.autoresize=n.autoresize}"undefined"!=typeof performance?e.getTime=performance.now.bind(performance):"undefined"!=typeof Date&&Date.now?e.getTime=Date.now.bind(Date):e.getTime="undefined"!=typeof process?function(){var t=process.hrtime();return.001*t[0]+1e-6*t[1]}:function(){return(new Date).getTime()},t.LGraph=e.LGraph=i,i.supported_types=["number","string","boolean"],i.prototype.getSupportedTypes=function(){return this.supported_types||i.supported_types},i.STATUS_STOPPED=1,i.STATUS_RUNNING=2,i.prototype.clear=function(){if(this.stop(),this.status=i.STATUS_STOPPED,this.last_node_id=0,this.last_link_id=0,this._version=-1,this._nodes)for(var t=0;t<this._nodes.length;++t){var e=this._nodes[t];e.onRemoved&&e.onRemoved()}this._nodes=[],this._nodes_by_id={},this._nodes_in_order=[],this._nodes_executable=null,this._groups=[],this.links={},this.iteration=0,this.config={},this.vars={},this.globaltime=0,this.runningtime=0,this.fixedtime=0,this.fixedtime_lapse=.01,this.elapsed_time=.01,this.last_update_time=0,this.starttime=0,this.catch_errors=!0,this.inputs={},this.outputs={},this.change(),this.sendActionToCanvas("clear")},i.prototype.attachCanvas=function(t){if(t.constructor!=a)throw"attachCanvas expects a LGraphCanvas instance";t.graph&&t.graph!=this&&t.graph.detachCanvas(t),t.graph=this,this.list_of_graphcanvas||(this.list_of_graphcanvas=[]),this.list_of_graphcanvas.push(t)},i.prototype.detachCanvas=function(t){if(this.list_of_graphcanvas){var e=this.list_of_graphcanvas.indexOf(t);-1!=e&&(t.graph=null,this.list_of_graphcanvas.splice(e,1))}},i.prototype.start=function(t){if(this.status!=i.STATUS_RUNNING){this.status=i.STATUS_RUNNING,this.onPlayEvent&&this.onPlayEvent(),this.sendEventToAllNodes("onStart"),this.starttime=e.getTime(),this.last_update_time=this.starttime,t=t||0;var n=this;if(0==t&&"undefined"!=typeof window&&window.requestAnimationFrame){function s(){-1==n.execution_timer_id&&(window.requestAnimationFrame(s),n.runStep(1,!this.catch_errors))}this.execution_timer_id=-1,s()}else n.runStep(1,!this.catch_errors)}},i.prototype.stop=function(){this.status!=i.STATUS_STOPPED&&(this.status=i.STATUS_STOPPED,this.onStopEvent&&this.onStopEvent(),null!=this.execution_timer_id&&(-1!=this.execution_timer_id&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))},i.prototype.runStep=function(t,i,n){t=t||1;var s=e.getTime();this.globaltime=.001*(s-this.starttime);var o=this._nodes_executable?this._nodes_executable:this._nodes;if(o){if(n=n||o.length,i){for(var r=0;r<t;r++){for(var a=0;a<n;++a){var l=o[a];l.mode==e.ALWAYS&&l.onExecute&&l.onExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute()}else try{for(r=0;r<t;r++){for(a=0;a<n;++a){l=o[a];l.mode==e.ALWAYS&&l.onExecute&&l.onExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute(),this.errors_in_execution=!1}catch(p){if(this.errors_in_execution=!0,e.throw_errors)throw p;e.debug&&console.log("Error during execution: "+p),this.stop()}var u=e.getTime(),h=u-s;0==h&&(h=1),this.execution_time=.001*h,this.globaltime+=.001*h,this.iteration+=1,this.elapsed_time=.001*(u-this.last_update_time),this.last_update_time=u}},i.prototype.updateExecutionOrder=function(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(var t=0;t<this._nodes_in_order.length;++t)this._nodes_in_order[t].onExecute&&this._nodes_executable.push(this._nodes_in_order[t])},i.prototype.computeExecutionOrder=function(t,i){for(var n=[],s=[],o={},r={},a={},l=0,u=this._nodes.length;l<u;++l){var h=this._nodes[l];if(!t||h.onExecute){o[h.id]=h;var p=0;if(h.inputs)for(var c=0,d=h.inputs.length;c<d;c++)h.inputs[c]&&null!=h.inputs[c].link&&(p+=1);0==p?(s.push(h),i&&(h._level=1)):(i&&(h._level=0),a[h.id]=p)}}while(1){if(0==s.length)break;h=s.shift();if(n.push(h),delete o[h.id],h.outputs)for(l=0;l<h.outputs.length;l++){var _=h.outputs[l];if(null!=_&&null!=_.links&&0!=_.links.length)for(c=0;c<_.links.length;c++){var g=_.links[c],f=this.links[g];if(f&&!r[f.id]){var v=this.getNodeById(f.target_id);null!=v?(i&&(!v._level||v._level<=h._level)&&(v._level=h._level+1),r[f.id]=!0,a[v.id]-=1,0==a[v.id]&&s.push(v)):r[f.id]=!0}}}}for(var l in o)n.push(o[l]);n.length!=this._nodes.length&&e.debug&&console.warn("something went wrong, nodes missing");for(u=n.length,l=0;l<u;++l)n[l].order=l;n=n.sort((function(t,e){var i=t.constructor.priority||t.priority||0,n=e.constructor.priority||e.priority||0;return i==n?t.order-e.order:i-n}));for(l=0;l<u;++l)n[l].order=l;return n},i.prototype.getAncestors=function(t){var e=[],i=[t],n={};while(i.length){var s=i.shift();if(s.inputs){n[s.id]||s==t||(n[s.id]=!0,e.push(s));for(var o=0;o<s.inputs.length;++o){var r=s.getInputNode(o);r&&-1==e.indexOf(r)&&i.push(r)}}}return e.sort((function(t,e){return t.order-e.order})),e},i.prototype.arrange=function(t){t=t||40;for(var e=this.computeExecutionOrder(!1,!0),i=[],n=0;n<e.length;++n){var s=e[n],o=s._level||1;i[o]||(i[o]=[]),i[o].push(s)}var r=t;for(n=0;n<i.length;++n){var a=i[n];if(a){for(var l=100,u=t,h=0;h<a.length;++h){s=a[h];s.pos[0]=r,s.pos[1]=u,s.size[0]>l&&(l=s.size[0]),u+=s.size[1]+t}r+=l+t}}this.setDirtyCanvas(!0,!0)},i.prototype.getTime=function(){return this.globaltime},i.prototype.getFixedTime=function(){return this.fixedtime},i.prototype.getElapsedTime=function(){return this.elapsed_time},i.prototype.sendEventToAllNodes=function(t,i,n){n=n||e.ALWAYS;var s=this._nodes_in_order?this._nodes_in_order:this._nodes;if(s)for(var o=0,r=s.length;o<r;++o){var a=s[o];a.constructor!==e.Subgraph||"onExecute"==t?a[t]&&a.mode==n&&(void 0===i?a[t]():i&&i.constructor===Array?a[t].apply(a,i):a[t](i)):a.mode==n&&a.sendEventToAllNodes(t,i,n)}},i.prototype.sendActionToCanvas=function(t,e){if(this.list_of_graphcanvas)for(var i=0;i<this.list_of_graphcanvas.length;++i){var n=this.list_of_graphcanvas[i];n[t]&&n[t].apply(n,e)}},i.prototype.add=function(t,i){if(t){if(t.constructor===o)return this._groups.push(t),this.setDirtyCanvas(!0),this.change(),t.graph=this,void this._version++;if(-1!=t.id&&null!=this._nodes_by_id[t.id]&&(console.warn("LiteGraph: there is already a node with this ID, changing it"),t.id=++this.last_node_id),this._nodes.length>=e.MAX_NUMBER_OF_NODES)throw"LiteGraph: max number of nodes in a graph reached";return null==t.id||-1==t.id?t.id=++this.last_node_id:this.last_node_id<t.id&&(this.last_node_id=t.id),t.graph=this,this._version++,this._nodes.push(t),this._nodes_by_id[t.id]=t,t.onAdded&&t.onAdded(this),this.config.align_to_grid&&t.alignToGrid(),i||this.updateExecutionOrder(),this.onNodeAdded&&this.onNodeAdded(t),this.setDirtyCanvas(!0),this.change(),t}},i.prototype.remove=function(t){if(t.constructor===e.LGraphGroup){var i=this._groups.indexOf(t);return-1!=i&&this._groups.splice(i,1),t.graph=null,this._version++,this.setDirtyCanvas(!0,!0),void this.change()}if(null!=this._nodes_by_id[t.id]&&!t.ignore_remove){if(t.inputs)for(var n=0;n<t.inputs.length;n++){var s=t.inputs[n];null!=s.link&&t.disconnectInput(n)}if(t.outputs)for(n=0;n<t.outputs.length;n++){s=t.outputs[n];null!=s.links&&s.links.length&&t.disconnectOutput(n)}if(t.onRemoved&&t.onRemoved(),t.graph=null,this._version++,this.list_of_graphcanvas)for(n=0;n<this.list_of_graphcanvas.length;++n){var o=this.list_of_graphcanvas[n];o.selected_nodes[t.id]&&delete o.selected_nodes[t.id],o.node_dragged==t&&(o.node_dragged=null)}var r=this._nodes.indexOf(t);-1!=r&&this._nodes.splice(r,1),delete this._nodes_by_id[t.id],this.onNodeRemoved&&this.onNodeRemoved(t),this.setDirtyCanvas(!0,!0),this.change(),this.updateExecutionOrder()}},i.prototype.getNodeById=function(t){return null==t?null:this._nodes_by_id[t]},i.prototype.findNodesByClass=function(t,e){e=e||[],e.length=0;for(var i=0,n=this._nodes.length;i<n;++i)this._nodes[i].constructor===t&&e.push(this._nodes[i]);return e},i.prototype.findNodesByType=function(t,e){t=t.toLowerCase();e=e||[],e.length=0;for(var i=0,n=this._nodes.length;i<n;++i)this._nodes[i].type.toLowerCase()==t&&e.push(this._nodes[i]);return e},i.prototype.findNodeByTitle=function(t){for(var e=0,i=this._nodes.length;e<i;++e)if(this._nodes[e].title==t)return this._nodes[e];return null},i.prototype.findNodesByTitle=function(t){for(var e=[],i=0,n=this._nodes.length;i<n;++i)this._nodes[i].title==t&&e.push(this._nodes[i]);return e},i.prototype.getNodeOnPos=function(t,e,i,n){i=i||this._nodes;for(var s=i.length-1;s>=0;s--){var o=i[s];if(o.isPointInside(t,e,n))return o}return null},i.prototype.getGroupOnPos=function(t,e){for(var i=this._groups.length-1;i>=0;i--){var n=this._groups[i];if(n.isPointInside(t,e,2,!0))return n}return null},i.prototype.checkNodeTypes=function(){for(var t=0;t<this._nodes.length;t++){var i=this._nodes[t],n=e.registered_node_types[i.type];if(i.constructor!=n){console.log("node being replaced by newer version: "+i.type);var s=e.createNode(i.type);!0,this._nodes[t]=s,s.configure(i.serialize()),s.graph=this,this._nodes_by_id[s.id]=s,i.inputs&&(s.inputs=i.inputs.concat()),i.outputs&&(s.outputs=i.outputs.concat())}}this.updateExecutionOrder()},i.prototype.onAction=function(t,i){this._input_nodes=this.findNodesByClass(e.GraphInput,this._input_nodes);for(var n=0;n<this._input_nodes.length;++n){var s=this._input_nodes[n];if(s.properties.name==t){s.onAction(t,i);break}}},i.prototype.trigger=function(t,e){this.onTrigger&&this.onTrigger(t,e)},i.prototype.addInput=function(t,e,i){var n=this.inputs[t];n||(this.inputs[t]={name:t,type:e,value:i},this._version++,this.onInputAdded&&this.onInputAdded(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange())},i.prototype.setInputData=function(t,e){var i=this.inputs[t];i&&(i.value=e)},i.prototype.getInputData=function(t){var e=this.inputs[t];return e?e.value:null},i.prototype.renameInput=function(t,e){if(e!=t){if(!this.inputs[t])return!1;if(this.inputs[e])return console.error("there is already one input with that name"),!1;this.inputs[e]=this.inputs[t],delete this.inputs[t],this._version++,this.onInputRenamed&&this.onInputRenamed(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange()}},i.prototype.changeInputType=function(t,e){if(!this.inputs[t])return!1;this.inputs[t].type&&String(this.inputs[t].type).toLowerCase()==String(e).toLowerCase()||(this.inputs[t].type=e,this._version++,this.onInputTypeChanged&&this.onInputTypeChanged(t,e))},i.prototype.removeInput=function(t){return!!this.inputs[t]&&(delete this.inputs[t],this._version++,this.onInputRemoved&&this.onInputRemoved(t),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0)},i.prototype.addOutput=function(t,e,i){this.outputs[t]={name:t,type:e,value:i},this._version++,this.onOutputAdded&&this.onOutputAdded(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange()},i.prototype.setOutputData=function(t,e){var i=this.outputs[t];i&&(i.value=e)},i.prototype.getOutputData=function(t){var e=this.outputs[t];return e?e.value:null},i.prototype.renameOutput=function(t,e){return!!this.outputs[t]&&(this.outputs[e]?(console.error("there is already one output with that name"),!1):(this.outputs[e]=this.outputs[t],delete this.outputs[t],this._version++,this.onOutputRenamed&&this.onOutputRenamed(t,e),void(this.onInputsOutputsChange&&this.onInputsOutputsChange())))},i.prototype.changeOutputType=function(t,e){if(!this.outputs[t])return!1;this.outputs[t].type&&String(this.outputs[t].type).toLowerCase()==String(e).toLowerCase()||(this.outputs[t].type=e,this._version++,this.onOutputTypeChanged&&this.onOutputTypeChanged(t,e))},i.prototype.removeOutput=function(t){return!!this.outputs[t]&&(delete this.outputs[t],this._version++,this.onOutputRemoved&&this.onOutputRemoved(t),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0)},i.prototype.triggerInput=function(t,e){for(var i=this.findNodesByTitle(t),n=0;n<i.length;++n)i[n].onTrigger(e)},i.prototype.setCallback=function(t,e){for(var i=this.findNodesByTitle(t),n=0;n<i.length;++n)i[n].setTrigger(e)},i.prototype.connectionChange=function(t,e){this.updateExecutionOrder(),this.onConnectionChange&&this.onConnectionChange(t),this._version++,this.sendActionToCanvas("onConnectionChange")},i.prototype.isLive=function(){if(!this.list_of_graphcanvas)return!1;for(var t=0;t<this.list_of_graphcanvas.length;++t){var e=this.list_of_graphcanvas[t];if(e.live_mode)return!0}return!1},i.prototype.clearTriggeredSlots=function(){for(var t in this.links){var e=this.links[t];e&&(e._last_time&&(e._last_time=0))}},i.prototype.change=function(){e.debug&&console.log("Graph changed"),this.sendActionToCanvas("setDirty",[!0,!0]),this.on_change&&this.on_change(this)},i.prototype.setDirtyCanvas=function(t,e){this.sendActionToCanvas("setDirty",[t,e])},i.prototype.removeLink=function(t){var e=this.links[t];if(e){var i=this.getNodeById(e.target_id);i&&i.disconnectInput(e.target_slot)}},i.prototype.serialize=function(){for(var t=[],i=0,s=this._nodes.length;i<s;++i)t.push(this._nodes[i].serialize());var o=[];for(var i in this.links){var r=this.links[i];if(!r.serialize){console.warn("weird LLink bug, link info is not a LLink but a regular object");var a=new n;for(var i in r)a[i]=r[i];this.links[i]=a,r=a}o.push(r.serialize())}var l=[];for(i=0;i<this._groups.length;++i)l.push(this._groups[i].serialize());var u={last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:t,links:o,groups:l,config:this.config,version:e.VERSION};return u},i.prototype.configure=function(t,i){if(t){i||this.clear();var o=t.nodes;if(t.links&&t.links.constructor===Array){for(var r=[],a=0;a<t.links.length;++a){var l=t.links[a],u=new n;u.configure(l),r[u.id]=u}t.links=r}for(var a in t)this[a]=t[a];var h=!1;if(this._nodes=[],o){a=0;for(var p=o.length;a<p;++a){var c=o[a],d=e.createNode(c.type,c.title);d||(e.debug&&console.log("Node not found or has errors: "+c.type),d=new s,d.last_serialization=c,d.has_errors=!0,h=!0),d.id=c.id,this.add(d,!0)}for(a=0,p=o.length;a<p;++a){c=o[a],d=this.getNodeById(c.id);d&&d.configure(c)}}if(this._groups.length=0,t.groups)for(a=0;a<t.groups.length;++a){var _=new e.LGraphGroup;_.configure(t.groups[a]),this.add(_)}return this.updateExecutionOrder(),this._version++,this.setDirtyCanvas(!0,!0),h}},i.prototype.load=function(t){var e=this,i=new XMLHttpRequest;i.open("GET",t,!0),i.send(null),i.onload=function(t){if(200===i.status){var n=JSON.parse(i.response);e.configure(n)}else console.error("Error loading graph:",i.status,i.response)},i.onerror=function(t){console.error("Error loading graph:",t)}},i.prototype.onNodeTrace=function(t,e,i){},n.prototype.configure=function(t){t.constructor===Array?(this.id=t[0],this.origin_id=t[1],this.origin_slot=t[2],this.target_id=t[3],this.target_slot=t[4],this.type=t[5]):(this.id=t.id,this.type=t.type,this.origin_id=t.origin_id,this.origin_slot=t.origin_slot,this.target_id=t.target_id,this.target_slot=t.target_slot)},n.prototype.serialize=function(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]},e.LLink=n,t.LGraphNode=e.LGraphNode=s,s.prototype._ctor=function(t){this.title=t||"Unnamed",this.size=[e.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),Object.defineProperty(this,"pos",{set:function(t){!t||t.length<2||(this._pos[0]=t[0],this._pos[1]=t[1])},get:function(){return this._pos},enumerable:!0}),this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={}},s.prototype.configure=function(t){for(var i in this.graph&&this.graph._version++,t)if("properties"!=i)null!=t[i]&&("object"==typeof t[i]?this[i]&&this[i].configure?this[i].configure(t[i]):this[i]=e.cloneObject(t[i],this[i]):this[i]=t[i]);else for(var n in t.properties)this.properties[n]=t.properties[n],this.onPropertyChanged&&this.onPropertyChanged(n,t.properties[n]);if(t.title||(this.title=this.constructor.title),this.onConnectionsChange){if(this.inputs)for(var s=0;s<this.inputs.length;++s){var o=this.inputs[s],r=this.graph?this.graph.links[o.link]:null;this.onConnectionsChange(e.INPUT,s,!0,r,o)}if(this.outputs)for(s=0;s<this.outputs.length;++s){var a=this.outputs[s];if(a.links)for(i=0;i<a.links.length;++i){r=this.graph?this.graph.links[a.links[i]]:null;this.onConnectionsChange(e.OUTPUT,s,!0,r,a)}}}if(t.widgets_values&&this.widgets)for(s=0;s<t.widgets_values.length;++s)this.widgets[s]&&(this.widgets[s].value=t.widgets_values[s]);this.onConfigure&&this.onConfigure(t)},s.prototype.serialize=function(){var t={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:e.cloneObject(this.flags),order:this.order,mode:this.mode};if(this.constructor===s&&this.last_serialization)return this.last_serialization;if(this.inputs&&(t.inputs=this.inputs),this.outputs){for(var i=0;i<this.outputs.length;i++)delete this.outputs[i]._data;t.outputs=this.outputs}if(this.title&&this.title!=this.constructor.title&&(t.title=this.title),this.properties&&(t.properties=e.cloneObject(this.properties)),this.widgets&&this.serialize_widgets){t.widgets_values=[];for(i=0;i<this.widgets.length;++i)t.widgets_values[i]=this.widgets[i].value}return t.type||(t.type=this.constructor.type),this.color&&(t.color=this.color),this.bgcolor&&(t.bgcolor=this.bgcolor),this.boxcolor&&(t.boxcolor=this.boxcolor),this.shape&&(t.shape=this.shape),this.onSerialize&&this.onSerialize(t)&&console.warn("node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter"),t},s.prototype.clone=function(){var t=e.createNode(this.type);if(!t)return null;var i=e.cloneObject(this.serialize());if(i.inputs)for(var n=0;n<i.inputs.length;++n)i.inputs[n].link=null;if(i.outputs)for(n=0;n<i.outputs.length;++n)i.outputs[n].links&&(i.outputs[n].links.length=0);return delete i["id"],t.configure(i),t},s.prototype.toString=function(){return JSON.stringify(this.serialize())},s.prototype.getTitle=function(){return this.title||this.constructor.title},s.prototype.setProperty=function(t,e){if(this.properties||(this.properties={}),e!==this.properties[t]){var i=this.properties[t];this.properties[t]=e,this.onPropertyChanged&&!1===this.onPropertyChanged(t,e)&&(this.properties[t]=i)}},s.prototype.setOutputData=function(t,e){if(this.outputs&&!(-1==t||t>=this.outputs.length)){var i=this.outputs[t];if(i&&(i._data=e,this.outputs[t].links))for(var n=0;n<this.outputs[t].links.length;n++){var s=this.outputs[t].links[n];this.graph.links[s].data=e}}},s.prototype.setOutputDataType=function(t,e){if(this.outputs&&!(-1==t||t>=this.outputs.length)){var i=this.outputs[t];if(i&&(i.type=e,this.outputs[t].links))for(var n=0;n<this.outputs[t].links.length;n++){var s=this.outputs[t].links[n];this.graph.links[s].type=e}}},s.prototype.getInputData=function(t,e){if(this.inputs&&!(t>=this.inputs.length||null==this.inputs[t].link)){var i=this.inputs[t].link,n=this.graph.links[i];if(!n)return null;if(!e)return n.data;var s=this.graph.getNodeById(n.origin_id);return s?(s.updateOutputData?s.updateOutputData(n.origin_slot):s.onExecute&&s.onExecute(),n.data):n.data}},s.prototype.getInputDataType=function(t){if(!this.inputs)return null;if(t>=this.inputs.length||null==this.inputs[t].link)return null;var e=this.inputs[t].link,i=this.graph.links[e];if(!i)return null;var n=this.graph.getNodeById(i.origin_id);if(!n)return i.type;var s=n.outputs[i.origin_slot];return s?s.type:null},s.prototype.getInputDataByName=function(t,e){var i=this.findInputSlot(t);return-1==i?null:this.getInputData(i,e)},s.prototype.isInputConnected=function(t){return!!this.inputs&&(t<this.inputs.length&&null!=this.inputs[t].link)},s.prototype.getInputInfo=function(t){return this.inputs&&t<this.inputs.length?this.inputs[t]:null},s.prototype.getInputNode=function(t){if(!this.inputs)return null;if(t>=this.inputs.length)return null;var e=this.inputs[t];if(!e||null===e.link)return null;var i=this.graph.links[e.link];return i?this.graph.getNodeById(i.origin_id):null},s.prototype.getInputOrProperty=function(t){if(!this.inputs||!this.inputs.length)return this.properties?this.properties[t]:null;for(var e=0,i=this.inputs.length;e<i;++e){var n=this.inputs[e];if(t==n.name&&null!=n.link){var s=this.graph.links[n.link];if(s)return s.data}}return this.properties[t]},s.prototype.getOutputData=function(t){if(!this.outputs)return null;if(t>=this.outputs.length)return null;var e=this.outputs[t];return e._data},s.prototype.getOutputInfo=function(t){return this.outputs&&t<this.outputs.length?this.outputs[t]:null},s.prototype.isOutputConnected=function(t){return!!this.outputs&&(t<this.outputs.length&&this.outputs[t].links&&this.outputs[t].links.length)},s.prototype.isAnyOutputConnected=function(){if(!this.outputs)return!1;for(var t=0;t<this.outputs.length;++t)if(this.outputs[t].links&&this.outputs[t].links.length)return!0;return!1},s.prototype.getOutputNodes=function(t){if(!this.outputs||0==this.outputs.length)return null;if(t>=this.outputs.length)return null;var e=this.outputs[t];if(!e.links||0==e.links.length)return null;for(var i=[],n=0;n<e.links.length;n++){var s=e.links[n],o=this.graph.links[s];if(o){var r=this.graph.getNodeById(o.target_id);r&&i.push(r)}}return i},s.prototype.trigger=function(t,i){if(this.outputs&&this.outputs.length){this.graph&&(this.graph._last_trigger_time=e.getTime());for(var n=0;n<this.outputs.length;++n){var s=this.outputs[n];!s||s.type!==e.EVENT||t&&s.name!=t||this.triggerSlot(n,i)}}},s.prototype.triggerSlot=function(t,i,n){if(this.outputs){var s=this.outputs[t];if(s){var o=s.links;if(o&&o.length){this.graph&&(this.graph._last_trigger_time=e.getTime());for(var r=0;r<o.length;++r){var a=o[r];if(null==n||n==a){var l=this.graph.links[o[r]];if(l){l._last_time=e.getTime();var u=this.graph.getNodeById(l.target_id);if(u){var h=u.inputs[l.target_slot];u.onAction?u.onAction(h.name,i):u.mode===e.ON_TRIGGER&&u.onExecute&&u.onExecute(i)}}}}}}}},s.prototype.clearTriggeredSlot=function(t,e){if(this.outputs){var i=this.outputs[t];if(i){var n=i.links;if(n&&n.length)for(var s=0;s<n.length;++s){var o=n[s];if(null==e||e==o){var r=this.graph.links[n[s]];r&&(r._last_time=0)}}}}},s.prototype.addProperty=function(t,e,i,n){var s={name:t,type:i,default_value:e};if(n)for(var o in n)s[o]=n[o];return this.properties_info||(this.properties_info=[]),this.properties_info.push(s),this.properties||(this.properties={}),this.properties[t]=e,s},s.prototype.addOutput=function(t,e,i){var n={name:t,type:e,links:null};if(i)for(var s in i)n[s]=i[s];return this.outputs||(this.outputs=[]),this.outputs.push(n),this.onOutputAdded&&this.onOutputAdded(n),this.size=this.computeSize(),this.setDirtyCanvas(!0,!0),n},s.prototype.addOutputs=function(t){for(var e=0;e<t.length;++e){var i=t[e],n={name:i[0],type:i[1],link:null};if(t[2])for(var s in i[2])n[s]=i[2][s];this.outputs||(this.outputs=[]),this.outputs.push(n),this.onOutputAdded&&this.onOutputAdded(n)}this.size=this.computeSize(),this.setDirtyCanvas(!0,!0)},s.prototype.removeOutput=function(t){this.disconnectOutput(t),this.outputs.splice(t,1);for(var e=t;e<this.outputs.length;++e)if(this.outputs[e]&&this.outputs[e].links)for(var i=this.outputs[e].links,n=0;n<i.length;++n){var s=this.graph.links[i[n]];s&&(s.origin_slot-=1)}this.size=this.computeSize(),this.onOutputRemoved&&this.onOutputRemoved(t),this.setDirtyCanvas(!0,!0)},s.prototype.addInput=function(t,e,i){e=e||0;var n={name:t,type:e,link:null};if(i)for(var s in i)n[s]=i[s];return this.inputs||(this.inputs=[]),this.inputs.push(n),this.size=this.computeSize(),this.onInputAdded&&this.onInputAdded(n),this.setDirtyCanvas(!0,!0),n},s.prototype.addInputs=function(t){for(var e=0;e<t.length;++e){var i=t[e],n={name:i[0],type:i[1],link:null};if(t[2])for(var s in i[2])n[s]=i[2][s];this.inputs||(this.inputs=[]),this.inputs.push(n),this.onInputAdded&&this.onInputAdded(n)}this.size=this.computeSize(),this.setDirtyCanvas(!0,!0)},s.prototype.removeInput=function(t){this.disconnectInput(t),this.inputs.splice(t,1);for(var e=t;e<this.inputs.length;++e)if(this.inputs[e]){var i=this.graph.links[this.inputs[e].link];i&&(i.target_slot-=1)}this.size=this.computeSize(),this.onInputRemoved&&this.onInputRemoved(t),this.setDirtyCanvas(!0,!0)},s.prototype.addConnection=function(t,e,i,n){var s={name:t,type:e,pos:i,direction:n,links:null};return this.connections.push(s),s},s.prototype.computeSize=function(t,i){if(this.constructor.size)return this.constructor.size.concat();var n=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1),s=i||new Float32Array([0,0]);n=Math.max(n,1);var o=e.NODE_TEXT_SIZE;s[1]=(this.constructor.slot_start_y||0)+n*e.NODE_SLOT_HEIGHT;var r=0;this.widgets&&this.widgets.length&&(r=this.widgets.length*(e.NODE_WIDGET_HEIGHT+4)+8),this.widgets_up?s[1]=Math.max(s[1],r):s[1]+=r;o=o;var a=f(this.title),l=0,u=0;if(this.inputs)for(var h=0,p=this.inputs.length;h<p;++h){var c=this.inputs[h],d=c.label||c.name||"",_=f(d);l<_&&(l=_)}if(this.outputs)for(h=0,p=this.outputs.length;h<p;++h){var g=this.outputs[h];d=g.label||g.name||"",_=f(d);u<_&&(u=_)}function f(t){return t?o*t.length*.6:0}return s[0]=Math.max(l+u+10,a),s[0]=Math.max(s[0],e.NODE_WIDTH),this.widgets&&this.widgets.length&&(s[0]=Math.max(s[0],1.5*e.NODE_WIDTH)),this.onResize&&this.onResize(s),this.constructor.min_height&&s[1]<this.constructor.min_height&&(s[1]=this.constructor.min_height),s[1]+=6,s},s.prototype.addWidget=function(t,e,i,n,s){this.widgets||(this.widgets=[]);var o={type:t.toLowerCase(),name:e,value:i,callback:n,options:s||{}};if(void 0!==o.options.y&&(o.y=o.options.y),n||console.warn("LiteGraph addWidget(...) without a callback"),"combo"==t&&!o.options.values)throw"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }";return this.widgets.push(o),this.size=this.computeSize(),o},s.prototype.addCustomWidget=function(t){return this.widgets||(this.widgets=[]),this.widgets.push(t),t},s.prototype.getBounding=function(t){return t=t||new Float32Array(4),t[0]=this.pos[0]-4,t[1]=this.pos[1]-e.NODE_TITLE_HEIGHT,t[2]=this.size[0]+4,t[3]=this.size[1]+e.NODE_TITLE_HEIGHT,this.onBounding&&this.onBounding(t),t},s.prototype.isPointInside=function(t,i,n,s){n=n||0;var o=this.graph&&this.graph.isLive()?0:e.NODE_TITLE_HEIGHT;if(s&&(o=0),this.flags&&this.flags.collapsed){if(m(t,i,this.pos[0]-n,this.pos[1]-e.NODE_TITLE_HEIGHT-n,(this._collapsed_width||e.NODE_COLLAPSED_WIDTH)+2*n,e.NODE_TITLE_HEIGHT+2*n))return!0}else if(this.pos[0]-4-n<t&&this.pos[0]+this.size[0]+4+n>t&&this.pos[1]-o-n<i&&this.pos[1]+this.size[1]+n>i)return!0;return!1},s.prototype.getSlotInPosition=function(t,e){var i=new Float32Array(2);if(this.inputs)for(var n=0,s=this.inputs.length;n<s;++n){var o=this.inputs[n];if(this.getConnectionPos(!0,n,i),m(t,e,i[0]-10,i[1]-5,20,10))return{input:o,slot:n,link_pos:i}}if(this.outputs)for(n=0,s=this.outputs.length;n<s;++n){var r=this.outputs[n];if(this.getConnectionPos(!1,n,i),m(t,e,i[0]-10,i[1]-5,20,10))return{output:r,slot:n,link_pos:i}}return null},s.prototype.findInputSlot=function(t){if(!this.inputs)return-1;for(var e=0,i=this.inputs.length;e<i;++e)if(t==this.inputs[e].name)return e;return-1},s.prototype.findOutputSlot=function(t){if(!this.outputs)return-1;for(var e=0,i=this.outputs.length;e<i;++e)if(t==this.outputs[e].name)return e;return-1},s.prototype.connect=function(t,i,s){if(s=s||0,!this.graph)return console.log("Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(t.constructor===String){if(t=this.findOutputSlot(t),-1==t)return e.debug&&console.log("Connect: Error, no slot of name "+t),null}else if(!this.outputs||t>=this.outputs.length)return e.debug&&console.log("Connect: Error, slot number not found"),null;if(i&&i.constructor===Number&&(i=this.graph.getNodeById(i)),!i)throw"target node is null";if(i==this)return null;if(s.constructor===String){if(s=i.findInputSlot(s),-1==s)return e.debug&&console.log("Connect: Error, no slot of name "+s),null}else{if(s===e.EVENT)return null;if(!i.inputs||s>=i.inputs.length)return e.debug&&console.log("Connect: Error, slot number not found"),null}null!=i.inputs[s].link&&i.disconnectInput(s);var o=this.outputs[t];if(i.onConnectInput&&!1===i.onConnectInput(s,o.type,o))return null;var r=i.inputs[s],a=null;return e.isValidConnection(o.type,r.type)&&(a=new n(++this.graph.last_link_id,r.type,this.id,t,i.id,s),this.graph.links[a.id]=a,null==o.links&&(o.links=[]),o.links.push(a.id),i.inputs[s].link=a.id,this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(e.OUTPUT,t,!0,a,o),i.onConnectionsChange&&i.onConnectionsChange(e.INPUT,s,!0,a,r),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(e.INPUT,i,s,this,t),this.graph.onNodeConnectionChange(e.OUTPUT,this,t,i,s))),this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this,a),a},s.prototype.disconnectOutput=function(t,i){if(t.constructor===String){if(t=this.findOutputSlot(t),-1==t)return e.debug&&console.log("Connect: Error, no slot of name "+t),!1}else if(!this.outputs||t>=this.outputs.length)return e.debug&&console.log("Connect: Error, slot number not found"),!1;var n=this.outputs[t];if(!n||!n.links||0==n.links.length)return!1;if(i){if(i.constructor===Number&&(i=this.graph.getNodeById(i)),!i)throw"Target Node not found";for(var s=0,o=n.links.length;s<o;s++){var r=n.links[s],a=this.graph.links[r];if(a.target_id==i.id){n.links.splice(s,1);var l=i.inputs[a.target_slot];l.link=null,delete this.graph.links[r],this.graph&&this.graph._version++,i.onConnectionsChange&&i.onConnectionsChange(e.INPUT,a.target_slot,!1,a,l),this.onConnectionsChange&&this.onConnectionsChange(e.OUTPUT,t,!1,a,n),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(e.OUTPUT,this,t),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(e.OUTPUT,this,t),this.graph.onNodeConnectionChange(e.INPUT,i,a.target_slot));break}}}else{for(s=0,o=n.links.length;s<o;s++){r=n.links[s],a=this.graph.links[r];if(a){i=this.graph.getNodeById(a.target_id),l=null;this.graph&&this.graph._version++,i&&(l=i.inputs[a.target_slot],l.link=null,i.onConnectionsChange&&i.onConnectionsChange(e.INPUT,a.target_slot,!1,a,l),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(e.INPUT,i,a.target_slot)),delete this.graph.links[r],this.onConnectionsChange&&this.onConnectionsChange(e.OUTPUT,t,!1,a,n),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(e.OUTPUT,this,t),this.graph.onNodeConnectionChange(e.INPUT,i,a.target_slot))}}n.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},s.prototype.disconnectInput=function(t){if(t.constructor===String){if(t=this.findInputSlot(t),-1==t)return e.debug&&console.log("Connect: Error, no slot of name "+t),!1}else if(!this.inputs||t>=this.inputs.length)return e.debug&&console.log("Connect: Error, slot number not found"),!1;var i=this.inputs[t];if(!i)return!1;var n=this.inputs[t].link;this.inputs[t].link=null;var s=this.graph.links[n];if(s){var o=this.graph.getNodeById(s.origin_id);if(!o)return!1;var r=o.outputs[s.origin_slot];if(!r||!r.links||0==r.links.length)return!1;for(var a=0,l=r.links.length;a<l;a++)if(r.links[a]==n){r.links.splice(a,1);break}delete this.graph.links[n],this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(e.INPUT,t,!1,s,i),o.onConnectionsChange&&o.onConnectionsChange(e.OUTPUT,a,!1,s,r),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(e.OUTPUT,o,a),this.graph.onNodeConnectionChange(e.INPUT,this,t))}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},s.prototype.getConnectionPos=function(t,i,n){n=n||new Float32Array(2);var s=0;t&&this.inputs&&(s=this.inputs.length),!t&&this.outputs&&(s=this.outputs.length);var o=.5*e.NODE_SLOT_HEIGHT;if(this.flags.collapsed){var r=this._collapsed_width||e.NODE_COLLAPSED_WIDTH;return this.horizontal?(n[0]=this.pos[0]+.5*r,n[1]=t?this.pos[1]-e.NODE_TITLE_HEIGHT:this.pos[1]):(n[0]=t?this.pos[0]:this.pos[0]+r,n[1]=this.pos[1]-.5*e.NODE_TITLE_HEIGHT),n}return t&&-1==i?(n[0]=this.pos[0]+.5*e.NODE_TITLE_HEIGHT,n[1]=this.pos[1]+.5*e.NODE_TITLE_HEIGHT,n):t&&s>i&&this.inputs[i].pos?(n[0]=this.pos[0]+this.inputs[i].pos[0],n[1]=this.pos[1]+this.inputs[i].pos[1],n):!t&&s>i&&this.outputs[i].pos?(n[0]=this.pos[0]+this.outputs[i].pos[0],n[1]=this.pos[1]+this.outputs[i].pos[1],n):this.horizontal?(n[0]=this.pos[0]+(i+.5)*(this.size[0]/s),n[1]=t?this.pos[1]-e.NODE_TITLE_HEIGHT:this.pos[1]+this.size[1],n):(n[0]=t?this.pos[0]+o:this.pos[0]+this.size[0]+1-o,n[1]=this.pos[1]+(i+.7)*e.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),n)},s.prototype.alignToGrid=function(){this.pos[0]=e.CANVAS_GRID_SIZE*Math.round(this.pos[0]/e.CANVAS_GRID_SIZE),this.pos[1]=e.CANVAS_GRID_SIZE*Math.round(this.pos[1]/e.CANVAS_GRID_SIZE)},s.prototype.trace=function(t){this.console||(this.console=[]),this.console.push(t),this.console.length>s.MAX_CONSOLE&&this.console.shift(),this.graph.onNodeTrace(this,t)},s.prototype.setDirtyCanvas=function(t,e){this.graph&&this.graph.sendActionToCanvas("setDirty",[t,e])},s.prototype.loadImage=function(t){var i=new Image;i.src=e.node_images_path+t,i.ready=!1;var n=this;return i.onload=function(){this.ready=!0,n.setDirtyCanvas(!0)},i},s.prototype.captureInput=function(t){if(this.graph&&this.graph.list_of_graphcanvas)for(var e=this.graph.list_of_graphcanvas,i=0;i<e.length;++i){var n=e[i];(t||n.node_capturing_input==this)&&(n.node_capturing_input=t?this:null)}},s.prototype.collapse=function(t){this.graph._version++,(!1!==this.constructor.collapsable||t)&&(this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0))},s.prototype.pin=function(t){this.graph._version++,this.flags.pinned=void 0===t?!this.flags.pinned:t},s.prototype.localToScreen=function(t,e,i){return[(t+this.pos[0])*i.scale+i.offset[0],(e+this.pos[1])*i.scale+i.offset[1]]},t.LGraphGroup=e.LGraphGroup=o,o.prototype._ctor=function(t){this.title=t||"Group",this.font_size=24,this.color=a.node_colors.pale_blue?a.node_colors.pale_blue.groupcolor:"#AAA",this._bounding=new Float32Array([10,10,140,80]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this.graph=null,Object.defineProperty(this,"pos",{set:function(t){!t||t.length<2||(this._pos[0]=t[0],this._pos[1]=t[1])},get:function(){return this._pos},enumerable:!0}),Object.defineProperty(this,"size",{set:function(t){!t||t.length<2||(this._size[0]=Math.max(140,t[0]),this._size[1]=Math.max(80,t[1]))},get:function(){return this._size},enumerable:!0})},o.prototype.configure=function(t){this.title=t.title,this._bounding.set(t.bounding),this.color=t.color,this.font=t.font},o.prototype.serialize=function(){var t=this._bounding;return{title:this.title,bounding:[Math.round(t[0]),Math.round(t[1]),Math.round(t[2]),Math.round(t[3])],color:this.color,font:this.font}},o.prototype.move=function(t,e,i){if(this._pos[0]+=t,this._pos[1]+=e,!i)for(var n=0;n<this._nodes.length;++n){var s=this._nodes[n];s.pos[0]+=t,s.pos[1]+=e}},o.prototype.recomputeInsideNodes=function(){this._nodes.length=0;for(var t=this.graph._nodes,e=new Float32Array(4),i=0;i<t.length;++i){var n=t[i];n.getBounding(e),E(this._bounding,e)&&this._nodes.push(n)}},o.prototype.isPointInside=s.prototype.isPointInside,o.prototype.setDirtyCanvas=s.prototype.setDirtyCanvas,e.DragAndScale=r,r.prototype.bindEvents=function(t){this.last_mouse=new Float32Array(2),this._binded_mouse_callback=this.onMouse.bind(this),t.addEventListener("mousedown",this._binded_mouse_callback),t.addEventListener("mousemove",this._binded_mouse_callback),t.addEventListener("mousewheel",this._binded_mouse_callback,!1),t.addEventListener("wheel",this._binded_mouse_callback,!1)},r.prototype.computeVisibleArea=function(){if(this.element){var t=this.element.width,e=this.element.height,i=-this.offset[0],n=-this.offset[1],s=i+t/this.scale,o=n+e/this.scale;this.visible_area[0]=i,this.visible_area[1]=n,this.visible_area[2]=s-i,this.visible_area[3]=o-n}else this.visible_area[0]=this.visible_area[1]=this.visible_area[2]=this.visible_area[3]=0},r.prototype.onMouse=function(t){if(this.enabled){var e=this.element,i=e.getBoundingClientRect(),n=t.clientX-i.left,s=t.clientY-i.top;t.canvasx=n,t.canvasy=s,t.dragging=this.dragging;var o=!1;if(this.onmouse&&(o=this.onmouse(t)),"mousedown"==t.type)this.dragging=!0,e.removeEventListener("mousemove",this._binded_mouse_callback),document.body.addEventListener("mousemove",this._binded_mouse_callback),document.body.addEventListener("mouseup",this._binded_mouse_callback);else if("mousemove"==t.type){if(!o){var r=n-this.last_mouse[0],a=s-this.last_mouse[1];this.dragging&&this.mouseDrag(r,a)}}else"mouseup"==t.type?(this.dragging=!1,document.body.removeEventListener("mousemove",this._binded_mouse_callback),document.body.removeEventListener("mouseup",this._binded_mouse_callback),e.addEventListener("mousemove",this._binded_mouse_callback)):"mousewheel"!=t.type&&"wheel"!=t.type&&"DOMMouseScroll"!=t.type||(t.eventType="mousewheel","wheel"==t.type?t.wheel=-t.deltaY:t.wheel=null!=t.wheelDeltaY?t.wheelDeltaY:-60*t.detail,t.delta=t.wheelDelta?t.wheelDelta/40:t.deltaY?-t.deltaY/3:0,this.changeDeltaScale(1+.05*t.delta));return this.last_mouse[0]=n,this.last_mouse[1]=s,t.preventDefault(),t.stopPropagation(),!1}},r.prototype.toCanvasContext=function(t){t.scale(this.scale,this.scale),t.translate(this.offset[0],this.offset[1])},r.prototype.convertOffsetToCanvas=function(t){return[(t[0]+this.offset[0])*this.scale,(t[1]+this.offset[1])*this.scale]},r.prototype.convertCanvasToOffset=function(t,e){return e=e||[0,0],e[0]=t[0]/this.scale-this.offset[0],e[1]=t[1]/this.scale-this.offset[1],e},r.prototype.mouseDrag=function(t,e){this.offset[0]+=t/this.scale,this.offset[1]+=e/this.scale,this.onredraw&&this.onredraw(this)},r.prototype.changeScale=function(t,e){if(t<this.min_scale?t=this.min_scale:t>this.max_scale&&(t=this.max_scale),t!=this.scale&&this.element){var i=this.element.getBoundingClientRect();if(i){e=e||[.5*i.width,.5*i.height];var n=this.convertCanvasToOffset(e);this.scale=t,Math.abs(this.scale-1)<.01&&(this.scale=1);var s=this.convertCanvasToOffset(e),o=[s[0]-n[0],s[1]-n[1]];this.offset[0]+=o[0],this.offset[1]+=o[1],this.onredraw&&this.onredraw(this)}}},r.prototype.changeDeltaScale=function(t,e){this.changeScale(this.scale*t,e)},r.prototype.reset=function(){this.scale=1,this.offset[0]=0,this.offset[1]=0},t.LGraphCanvas=e.LGraphCanvas=a,a.link_type_colors={"-1":e.EVENT_LINK_COLOR,number:"#AAA",node:"#DCA"},a.gradients={},a.prototype.clear=function(){this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.visible_nodes=[],this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.highlighted_links={},this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.visible_area.set([0,0,0,0]),this.onClear&&this.onClear()},a.prototype.setGraph=function(t,e){this.graph!=t&&(e||this.clear(),t||!this.graph?(t.attachCanvas(this),this.setDirty(!0,!0)):this.graph.detachCanvas(this))},a.prototype.openSubgraph=function(t){if(!t)throw"graph cannot be null";if(this.graph==t)throw"graph cannot be the same";this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),t.attachCanvas(this),this.setDirty(!0,!0)},a.prototype.closeSubgraph=function(){if(this._graph_stack&&0!=this._graph_stack.length){var t=this.graph._subgraph_node,e=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},e.attachCanvas(this),this.setDirty(!0,!0),t&&(this.centerOnNode(t),this.selectNodes([t]))}},a.prototype.getCurrentGraph=function(){return this.graph},a.prototype.setCanvas=function(t,e){if(t&&t.constructor===String&&(t=document.getElementById(t),!t))throw"Error creating LiteGraph canvas: Canvas not found";if(t!==this.canvas&&(!t&&this.canvas&&(e||this.unbindEvents()),this.canvas=t,this.ds.element=t,t)){if(t.className+=" lgraphcanvas",t.data=this,t.tabindex="1",this.bgcanvas=null,this.bgcanvas||(this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height),null==t.getContext){if("canvas"!=t.localName)throw"Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+t.localName;throw"This browser doesn't support Canvas"}var i=this.ctx=t.getContext("2d");null==i&&(t.webgl_enabled||console.warn("This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL()),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),e||this.bindEvents()}},a.prototype._doNothing=function(t){return t.preventDefault(),!1},a.prototype._doReturnTrue=function(t){return t.preventDefault(),!0},a.prototype.bindEvents=function(){if(this._events_binded)console.warn("LGraphCanvas: events already binded");else{var t=this.canvas,e=this.getCanvasWindow(),i=e.document;this._mousedown_callback=this.processMouseDown.bind(this),this._mousewheel_callback=this.processMouseWheel.bind(this),t.addEventListener("mousedown",this._mousedown_callback,!0),t.addEventListener("mousemove",this._mousemove_callback),t.addEventListener("mousewheel",this._mousewheel_callback,!1),t.addEventListener("contextmenu",this._doNothing),t.addEventListener("DOMMouseScroll",this._mousewheel_callback,!1),t.addEventListener("touchstart",this.touchHandler,!0),t.addEventListener("touchmove",this.touchHandler,!0),t.addEventListener("touchend",this.touchHandler,!0),t.addEventListener("touchcancel",this.touchHandler,!0),this._key_callback=this.processKey.bind(this),t.addEventListener("keydown",this._key_callback,!0),i.addEventListener("keyup",this._key_callback,!0),this._ondrop_callback=this.processDrop.bind(this),t.addEventListener("dragover",this._doNothing,!1),t.addEventListener("dragend",this._doNothing,!1),t.addEventListener("drop",this._ondrop_callback,!1),t.addEventListener("dragenter",this._doReturnTrue,!1),this._events_binded=!0}},a.prototype.unbindEvents=function(){if(this._events_binded){var t=this.getCanvasWindow(),e=t.document;this.canvas.removeEventListener("mousedown",this._mousedown_callback),this.canvas.removeEventListener("mousewheel",this._mousewheel_callback),this.canvas.removeEventListener("DOMMouseScroll",this._mousewheel_callback),this.canvas.removeEventListener("keydown",this._key_callback),e.removeEventListener("keyup",this._key_callback),this.canvas.removeEventListener("contextmenu",this._doNothing),this.canvas.removeEventListener("drop",this._ondrop_callback),this.canvas.removeEventListener("dragenter",this._doReturnTrue),this.canvas.removeEventListener("touchstart",this.touchHandler),this.canvas.removeEventListener("touchmove",this.touchHandler),this.canvas.removeEventListener("touchend",this.touchHandler),this.canvas.removeEventListener("touchcancel",this.touchHandler),this._mousedown_callback=null,this._mousewheel_callback=null,this._key_callback=null,this._ondrop_callback=null,this._events_binded=!1}else console.warn("LGraphCanvas: no events binded")},a.getFileExtension=function(t){var e=t.indexOf("?");-1!=e&&(t=t.substr(0,e));var i=t.lastIndexOf(".");return-1==i?"":t.substr(i+1).toLowerCase()},a.prototype.enableWebGL=function(){if(void 0===typeof GL)throw"litegl.js must be included to use a WebGL canvas";if(void 0===typeof enableWebGLCanvas)throw"webglCanvas.js must be included to use this feature";this.gl=this.ctx=enableWebGLCanvas(this.canvas),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.bgctx=this.gl,this.canvas.webgl_enabled=!0},a.prototype.setDirty=function(t,e){t&&(this.dirty_canvas=!0),e&&(this.dirty_bgcanvas=!0)},a.prototype.getCanvasWindow=function(){if(!this.canvas)return window;var t=this.canvas.ownerDocument;return t.defaultView||t.parentWindow},a.prototype.startRendering=function(){function t(){this.pause_rendering||this.draw();var e=this.getCanvasWindow();this.is_rendering&&e.requestAnimationFrame(t.bind(this))}this.is_rendering||(this.is_rendering=!0,t.call(this))},a.prototype.stopRendering=function(){this.is_rendering=!1},a.prototype.processMouseDown=function(t){if(this.graph){this.adjustMouseEvent(t);var i=this.getCanvasWindow();i.document;a.active_canvas=this;this.canvas.removeEventListener("mousemove",this._mousemove_callback),i.document.addEventListener("mousemove",this._mousemove_callback,!0),i.document.addEventListener("mouseup",this._mouseup_callback,!0);var n=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes,5),s=!1,o=e.getTime(),r=o-this.last_mouseclick<300;if(this.canvas_mouse[0]=t.canvasX,this.canvas_mouse[1]=t.canvasY,this.canvas.focus(),e.closeAllContextMenus(i),!this.onMouse||1!=this.onMouse(t)){if(1==t.which){t.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),this.dragging_rectangle[0]=t.canvasX,this.dragging_rectangle[1]=t.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,s=!0);var l=!1;if(n&&this.allow_interaction&&!s&&!this.read_only){if(this.live_mode||n.flags.pinned||this.bringToFront(n),!this.connecting_node&&!n.flags.collapsed&&!this.live_mode)if(!s&&!1!==n.resizable&&m(t.canvasX,t.canvasY,n.pos[0]+n.size[0]-5,n.pos[1]+n.size[1]-5,10,10))this.resizing_node=n,this.canvas.style.cursor="se-resize",s=!0;else{if(n.outputs)for(var u=0,h=n.outputs.length;u<h;++u){var p=n.outputs[u],c=n.getConnectionPos(!1,u);if(m(t.canvasX,t.canvasY,c[0]-15,c[1]-10,30,20)){this.connecting_node=n,this.connecting_output=p,this.connecting_pos=n.getConnectionPos(!1,u),this.connecting_slot=u,t.shiftKey&&n.disconnectOutput(u),r?n.onOutputDblClick&&n.onOutputDblClick(u,t):n.onOutputClick&&n.onOutputClick(u,t),s=!0;break}}if(n.inputs)for(u=0,h=n.inputs.length;u<h;++u){var d=n.inputs[u];c=n.getConnectionPos(!0,u);if(m(t.canvasX,t.canvasY,c[0]-15,c[1]-10,30,20)&&(r?n.onInputDblClick&&n.onInputDblClick(u,t):n.onInputClick&&n.onInputClick(u,t),null!==d.link)){var _=this.graph.links[d.link];n.disconnectInput(u),(this.allow_reconnect_links||t.shiftKey)&&(this.connecting_node=this.graph._nodes_by_id[_.origin_id],this.connecting_slot=_.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot)),this.dirty_bgcanvas=!0,s=!0}}}if(!s){var g=!1,v=this.processNodeWidgets(n,this.canvas_mouse,t);v&&(g=!0,this.node_widget=[n,v]),r&&this.selected_nodes[n.id]&&(n.onDblClick&&n.onDblClick(t,[t.canvasX-n.pos[0],t.canvasY-n.pos[1]],this),this.processNodeDblClicked(n),g=!0),n.onMouseDown&&n.onMouseDown(t,[t.canvasX-n.pos[0],t.canvasY-n.pos[1]],this)?g=!0:this.live_mode&&(l=!0,g=!0),g||(this.allow_dragnodes&&(this.node_dragged=n),this.selected_nodes[n.id]||this.processNodeSelected(n,t)),this.dirty_canvas=!0}}else{if(!this.read_only)for(u=0;u<this.visible_links.length;++u){var y=this.visible_links[u],b=y._pos;if(!(!b||t.canvasX<b[0]-4||t.canvasX>b[0]+4||t.canvasY<b[1]-4||t.canvasY>b[1]+4)){this.showLinkMenu(y,t);break}}if(this.selected_group=this.graph.getGroupOnPos(t.canvasX,t.canvasY),this.selected_group_resizing=!1,this.selected_group&&!this.read_only){t.ctrlKey&&(this.dragging_rectangle=null);var E=f([t.canvasX,t.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]]);E*this.ds.scale<10?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes()}r&&!this.read_only&&this.showSearchBox(t),l=!0}!s&&l&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else 2==t.which||3==t.which&&(this.read_only||this.processContextMenu(n,t));return this.last_mouse[0]=t.localX,this.last_mouse[1]=t.localY,this.last_mouseclick=e.getTime(),this.last_mouse_dragging=!0,this.graph.change(),(!i.document.activeElement||"input"!=i.document.activeElement.nodeName.toLowerCase()&&"textarea"!=i.document.activeElement.nodeName.toLowerCase())&&t.preventDefault(),t.stopPropagation(),this.onMouseDown&&this.onMouseDown(t),!1}}},a.prototype.processMouseMove=function(t){if(this.autoresize&&this.resize(),this.graph){a.active_canvas=this,this.adjustMouseEvent(t);var i=[t.localX,t.localY],n=[i[0]-this.last_mouse[0],i[1]-this.last_mouse[1]];if(this.last_mouse=i,this.canvas_mouse[0]=t.canvasX,this.canvas_mouse[1]=t.canvasY,t.dragging=this.last_mouse_dragging,this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.canvas_mouse,t,this.node_widget[1]),this.dirty_canvas=!0),this.dragging_rectangle)this.dragging_rectangle[2]=t.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=t.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only){if(this.selected_group_resizing)this.selected_group.size=[t.canvasX-this.selected_group.pos[0],t.canvasY-this.selected_group.pos[1]];else{var s=n[0]/this.ds.scale,o=n[1]/this.ds.scale;this.selected_group.move(s,o,t.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)}this.dirty_bgcanvas=!0}else if(this.dragging_canvas)this.ds.offset[0]+=n[0]/this.ds.scale,this.ds.offset[1]+=n[1]/this.ds.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if(this.allow_interaction&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);for(var r=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes),l=0,u=this.graph._nodes.length;l<u;++l)this.graph._nodes[l].mouseOver&&r!=this.graph._nodes[l]&&(this.graph._nodes[l].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave(t),this.node_over=null,this.dirty_canvas=!0);if(r){if(r.mouseOver||(r.mouseOver=!0,this.node_over=r,this.dirty_canvas=!0,r.onMouseEnter&&r.onMouseEnter(t)),r.onMouseMove&&r.onMouseMove(t,[t.canvasX-r.pos[0],t.canvasY-r.pos[1]],this),this.connecting_node){var h=this._highlight_input||[0,0];if(this.isOverNodeBox(r,t.canvasX,t.canvasY));else{var p=this.isOverNodeInput(r,t.canvasX,t.canvasY,h);if(-1!=p&&r.inputs[p]){var c=r.inputs[p].type;e.isValidConnection(this.connecting_output.type,c)&&(this._highlight_input=h)}else this._highlight_input=null}}this.canvas&&(m(t.canvasX,t.canvasY,r.pos[0]+r.size[0]-5,r.pos[1]+r.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else{var d=null;for(l=0;l<this.visible_links.length;++l){var _=this.visible_links[l],g=_._pos;if(!(!g||t.canvasX<g[0]-4||t.canvasX>g[0]+4||t.canvasY<g[1]-4||t.canvasY>g[1]+4)){d=_;break}}d!=this.over_link_center&&(this.over_link_center=d,this.dirty_canvas=!0),this.canvas&&(this.canvas.style.cursor="")}if(this.node_capturing_input&&this.node_capturing_input!=r&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove(t),this.node_dragged&&!this.live_mode){for(var l in this.selected_nodes){var f=this.selected_nodes[l];f.pos[0]+=n[0]/this.ds.scale,f.pos[1]+=n[1]/this.ds.scale}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){this.resizing_node.size[0]=t.canvasX-this.resizing_node.pos[0],this.resizing_node.size[1]=t.canvasY-this.resizing_node.pos[1];var v=Math.max(this.resizing_node.inputs?this.resizing_node.inputs.length:0,this.resizing_node.outputs?this.resizing_node.outputs.length:0),y=v*e.NODE_SLOT_HEIGHT+(this.resizing_node.widgets?this.resizing_node.widgets.length:0)*(e.NODE_WIDGET_HEIGHT+4)+4;this.resizing_node.size[1]<y&&(this.resizing_node.size[1]=y),this.resizing_node.size[0]<e.NODE_MIN_WIDTH&&(this.resizing_node.size[0]=e.NODE_MIN_WIDTH),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return t.preventDefault(),!1}},a.prototype.processMouseUp=function(t){if(this.graph){var i=this.getCanvasWindow(),n=i.document;a.active_canvas=this,n.removeEventListener("mousemove",this._mousemove_callback,!0),this.canvas.addEventListener("mousemove",this._mousemove_callback,!0),n.removeEventListener("mouseup",this._mouseup_callback,!0),this.adjustMouseEvent(t);var s=e.getTime();if(t.click_time=s-this.last_mouseclick,this.last_mouse_dragging=!1,1==t.which){if(this.node_widget=null,this.selected_group){var o=this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),r=this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]);this.selected_group.move(o,r,t.ctrlKey),this.selected_group.pos[0]=Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null}if(this.selected_group_resizing=!1,this.dragging_rectangle){if(this.graph){var l=this.graph._nodes,u=new Float32Array(4);this.deselectAllNodes();var h=Math.abs(this.dragging_rectangle[2]),p=Math.abs(this.dragging_rectangle[3]),c=this.dragging_rectangle[2]<0?this.dragging_rectangle[0]-h:this.dragging_rectangle[0],d=this.dragging_rectangle[3]<0?this.dragging_rectangle[1]-p:this.dragging_rectangle[1];this.dragging_rectangle[0]=c,this.dragging_rectangle[1]=d,this.dragging_rectangle[2]=h,this.dragging_rectangle[3]=p;for(var _=[],g=0;g<l.length;++g){var f=l[g];f.getBounding(u),E(this.dragging_rectangle,u)&&_.push(f)}_.length&&this.selectNodes(_)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_canvas=!0,this.dirty_bgcanvas=!0;f=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes);if(f)if(this.connecting_output.type==e.EVENT&&this.isOverNodeBox(f,t.canvasX,t.canvasY))this.connecting_node.connect(this.connecting_slot,f,e.EVENT);else{var v=this.isOverNodeInput(f,t.canvasX,t.canvasY);if(-1!=v)this.connecting_node.connect(this.connecting_slot,f,v);else{var y=f.getInputInfo(0);this.connecting_output.type==e.EVENT?this.connecting_node.connect(this.connecting_slot,f,e.EVENT):y&&!y.link&&e.isValidConnection(y.type&&this.connecting_output.type)&&this.connecting_node.connect(this.connecting_slot,f,0)}}this.connecting_output=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else if(this.resizing_node)this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.resizing_node=null;else if(this.node_dragged){f=this.node_dragged;f&&t.click_time<300&&m(t.canvasX,t.canvasY,f.pos[0],f.pos[1]-e.NODE_TITLE_HEIGHT,e.NODE_TITLE_HEIGHT,e.NODE_TITLE_HEIGHT)&&f.collapse(),this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),this.graph.config.align_to_grid&&this.node_dragged.alignToGrid(),this.node_dragged=null}else{f=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes);!f&&t.click_time<300&&this.deselectAllNodes(),this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp(t,[t.canvasX-this.node_over.pos[0],t.canvasY-this.node_over.pos[1]],this),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp(t,[t.canvasX-this.node_capturing_input.pos[0],t.canvasY-this.node_capturing_input.pos[1]])}}else 2==t.which?(this.dirty_canvas=!0,this.dragging_canvas=!1):3==t.which&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return this.graph.change(),t.stopPropagation(),t.preventDefault(),!1}},a.prototype.processMouseWheel=function(t){if(this.graph&&this.allow_dragcanvas){var e=null!=t.wheelDeltaY?t.wheelDeltaY:-60*t.detail;this.adjustMouseEvent(t);var i=this.ds.scale;return e>0?i*=1.1:e<0&&(i*=1/1.1),this.ds.changeScale(i,[t.localX,t.localY]),this.graph.change(),t.preventDefault(),!1}},a.prototype.isOverNodeBox=function(t,i,n){var s=e.NODE_TITLE_HEIGHT;return!!m(i,n,t.pos[0]+2,t.pos[1]+2-s,s-4,s-4)},a.prototype.isOverNodeInput=function(t,e,i,n){if(t.inputs)for(var s=0,o=t.inputs.length;s<o;++s){t.inputs[s];var r=t.getConnectionPos(!0,s),a=!1;if(a=t.horizontal?m(e,i,r[0]-5,r[1]-10,10,20):m(e,i,r[0]-10,r[1]-5,40,10),a)return n&&(n[0]=r[0],n[1]=r[1]),s}return-1},a.prototype.processKey=function(t){if(this.graph){var e=!1;if("input"!=t.target.localName){if("keydown"==t.type){if(32==t.keyCode&&(this.dragging_canvas=!0,e=!0),65==t.keyCode&&t.ctrlKey&&(this.selectNodes(),e=!0),"KeyC"!=t.code||!t.metaKey&&!t.ctrlKey||t.shiftKey||this.selected_nodes&&(this.copyToClipboard(),e=!0),"KeyV"!=t.code||!t.metaKey&&!t.ctrlKey||t.shiftKey||this.pasteFromClipboard(),46!=t.keyCode&&8!=t.keyCode||"input"!=t.target.localName&&"textarea"!=t.target.localName&&(this.deleteSelectedNodes(),e=!0),this.selected_nodes)for(var i in this.selected_nodes)this.selected_nodes[i].onKeyDown&&this.selected_nodes[i].onKeyDown(t)}else if("keyup"==t.type&&(32==t.keyCode&&(this.dragging_canvas=!1),this.selected_nodes))for(var i in this.selected_nodes)this.selected_nodes[i].onKeyUp&&this.selected_nodes[i].onKeyUp(t);return this.graph.change(),e?(t.preventDefault(),t.stopImmediatePropagation(),!1):void 0}}},a.prototype.copyToClipboard=function(){var t={nodes:[],links:[]},e=0,i=[];for(var n in this.selected_nodes){var s=this.selected_nodes[n];s._relative_id=e,i.push(s),e+=1}for(n=0;n<i.length;++n){s=i[n];if(t.nodes.push(s.clone().serialize()),s.inputs&&s.inputs.length)for(var o=0;o<s.inputs.length;++o){var r=s.inputs[o];if(r&&null!=r.link){var a=this.graph.links[r.link];if(a){var l=this.graph.getNodeById(a.origin_id);l&&this.selected_nodes[l.id]&&t.links.push([l._relative_id,o,s._relative_id,a.target_slot])}}}}localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(t))},a.prototype.pasteFromClipboard=function(){var t=localStorage.getItem("litegrapheditor_clipboard");if(t){for(var i=JSON.parse(t),n=[],s=0;s<i.nodes.length;++s){var o=i.nodes[s],r=e.createNode(o.type);r&&(r.configure(o),r.pos[0]+=5,r.pos[1]+=5,this.graph.add(r),n.push(r))}for(s=0;s<i.links.length;++s){var a=i.links[s],l=n[a[0]],u=n[a[2]];l.connect(a[1],u,a[3])}this.selectNodes(n)}},a.prototype.processDrop=function(t){t.preventDefault(),this.adjustMouseEvent(t);var e=[t.canvasX,t.canvasY],i=this.graph.getNodeOnPos(e[0],e[1]);if(!i){var n=null;return this.onDropItem&&(n=this.onDropItem(event)),void(n||this.checkDropItem(t))}if(i.onDropFile||i.onDropData){var s=t.dataTransfer.files;if(s&&s.length)for(var o=0;o<s.length;o++){var r=t.dataTransfer.files[0],l=r.name;a.getFileExtension(l);if(i.onDropFile&&i.onDropFile(r),i.onDropData){var u=new FileReader;u.onload=function(t){var e=t.target.result;i.onDropData(e,l,r)};var h=r.type.split("/")[0];"text"==h||""==h?u.readAsText(r):"image"==h?u.readAsDataURL(r):u.readAsArrayBuffer(r)}}}return!(!i.onDropItem||!i.onDropItem(event))||!!this.onDropItem&&this.onDropItem(event)},a.prototype.checkDropItem=function(t){if(t.dataTransfer.files.length){var i=t.dataTransfer.files[0],n=a.getFileExtension(i.name).toLowerCase(),s=e.node_types_by_file_extension[n];if(s){var o=e.createNode(s.type);o.pos=[t.canvasX,t.canvasY],this.graph.add(o),o.onDropFile&&o.onDropFile(i)}}},a.prototype.processNodeDblClicked=function(t){this.onShowNodePanel&&this.onShowNodePanel(t),this.onNodeDblClicked&&this.onNodeDblClicked(t),this.setDirty(!0)},a.prototype.processNodeSelected=function(t,e){this.selectNode(t,e&&e.shiftKey),this.onNodeSelected&&this.onNodeSelected(t)},a.prototype.processNodeDeselected=function(t){this.deselectNode(t),this.onNodeDeselected&&this.onNodeDeselected(t)},a.prototype.selectNode=function(t,e){null==t?this.deselectAllNodes():this.selectNodes([t],e)},a.prototype.selectNodes=function(t,e){e||this.deselectAllNodes(),t=t||this.graph._nodes;for(var i=0;i<t.length;++i){var n=t[i];if(!n.is_selected){if(!n.is_selected&&n.onSelected&&n.onSelected(),n.is_selected=!0,this.selected_nodes[n.id]=n,n.inputs)for(var s=0;s<n.inputs.length;++s)this.highlighted_links[n.inputs[s].link]=!0;if(n.outputs)for(s=0;s<n.outputs.length;++s){var o=n.outputs[s];if(o.links)for(var r=0;r<o.links.length;++r)this.highlighted_links[o.links[r]]=!0}}}this.setDirty(!0)},a.prototype.deselectNode=function(t){if(t.is_selected){if(t.onDeselected&&t.onDeselected(),t.is_selected=!1,t.inputs)for(var e=0;e<t.inputs.length;++e)delete this.highlighted_links[t.inputs[e].link];if(t.outputs)for(e=0;e<t.outputs.length;++e){var i=t.outputs[e];if(i.links)for(var n=0;n<i.links.length;++n)delete this.highlighted_links[i.links[n]]}}},a.prototype.deselectAllNodes=function(){if(this.graph){for(var t=this.graph._nodes,e=0,i=t.length;e<i;++e){var n=t[e];n.is_selected&&(n.onDeselected&&n.onDeselected(),n.is_selected=!1)}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0)}},a.prototype.deleteSelectedNodes=function(){for(var t in this.selected_nodes){var e=this.selected_nodes[t];this.graph.remove(e)}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0)},a.prototype.centerOnNode=function(t){this.ds.offset[0]=-t.pos[0]-.5*t.size[0]+.5*this.canvas.width/this.ds.scale,this.ds.offset[1]=-t.pos[1]-.5*t.size[1]+.5*this.canvas.height/this.ds.scale,this.setDirty(!0,!0)},a.prototype.adjustMouseEvent=function(t){if(this.canvas){var e=this.canvas.getBoundingClientRect();t.localX=t.clientX-e.left,t.localY=t.clientY-e.top}else t.localX=t.clientX,t.localY=t.clientY;t.deltaX=t.localX-this.last_mouse_position[0],t.deltaY=t.localY-this.last_mouse_position[1],this.last_mouse_position[0]=t.localX,this.last_mouse_position[1]=t.localY,t.canvasX=t.localX/this.ds.scale-this.ds.offset[0],t.canvasY=t.localY/this.ds.scale-this.ds.offset[1]},a.prototype.setZoom=function(t,e){this.ds.changeScale(t,e),this.dirty_canvas=!0,this.dirty_bgcanvas=!0},a.prototype.convertOffsetToCanvas=function(t,e){return this.ds.convertOffsetToCanvas(t,e)},a.prototype.convertCanvasToOffset=function(t,e){return this.ds.convertCanvasToOffset(t,e)},a.prototype.convertEventToCanvasOffset=function(t){var e=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([t.clientX-e.left,t.clientY-e.top])},a.prototype.bringToFront=function(t){var e=this.graph._nodes.indexOf(t);-1!=e&&(this.graph._nodes.splice(e,1),this.graph._nodes.push(t))},a.prototype.sendToBack=function(t){var e=this.graph._nodes.indexOf(t);-1!=e&&(this.graph._nodes.splice(e,1),this.graph._nodes.unshift(t))};var l=new Float32Array(4);a.prototype.computeVisibleNodes=function(t,e){var i=e||[];i.length=0,t=t||this.graph._nodes;for(var n=0,s=t.length;n<s;++n){var o=t[n];(!this.live_mode||o.onDrawBackground||o.onDrawForeground)&&(E(this.visible_area,o.getBounding(l))&&i.push(o))}return i},a.prototype.draw=function(t,i){if(this.canvas){var n=e.getTime();this.render_time=.001*(n-this.last_draw_time),this.last_draw_time=n,this.graph&&this.ds.computeVisibleArea(),(this.dirty_bgcanvas||i||this.always_render_background||this.graph&&this.graph._last_trigger_time&&n-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas(),(this.dirty_canvas||t)&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1}},a.prototype.drawFrontCanvas=function(){this.dirty_canvas=!1,this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));var t=this.ctx;if(t){t.start2D&&t.start2D();var i=this.canvas;if(t.restore(),t.setTransform(1,0,0,1,0,0),this.dirty_area&&(t.save(),t.beginPath(),t.rect(this.dirty_area[0],this.dirty_area[1],this.dirty_area[2],this.dirty_area[3]),t.clip()),this.clear_background&&t.clearRect(0,0,i.width,i.height),this.bgcanvas==this.canvas?this.drawBackCanvas():t.drawImage(this.bgcanvas,0,0),this.onRender&&this.onRender(i,t),this.show_info&&this.renderInfo(t),this.graph){t.save(),this.ds.toCanvasContext(t);for(var n=this.computeVisibleNodes(null,this.visible_nodes),s=0;s<n.length;++s){var o=n[s];t.save(),t.translate(o.pos[0],o.pos[1]),this.drawNode(o,t),1,t.restore()}if(this.render_execution_order&&this.drawExecutionOrder(t),this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(t)),null!=this.connecting_pos){t.lineWidth=this.connections_width;var r=null;switch(this.connecting_output.type){case e.EVENT:r=e.EVENT_LINK_COLOR;break;default:r=e.CONNECTING_LINK_COLOR}this.renderLink(t,this.connecting_pos,[this.canvas_mouse[0],this.canvas_mouse[1]],null,!1,null,r,this.connecting_output.dir||(this.connecting_node.horizontal?e.DOWN:e.RIGHT),e.CENTER),t.beginPath(),this.connecting_output.type===e.EVENT||this.connecting_output.shape===e.BOX_SHAPE?t.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10):t.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,2*Math.PI),t.fill(),t.fillStyle="#ffcc00",this._highlight_input&&(t.beginPath(),t.arc(this._highlight_input[0],this._highlight_input[1],6,0,2*Math.PI),t.fill())}this.dragging_rectangle&&(t.strokeStyle="#FFF",t.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3])),this.over_link_center&&this.render_link_tooltip?this.drawLinkTooltip(t,this.over_link_center):this.onDrawLinkTooltip&&this.onDrawLinkTooltip(t,null),this.onDrawForeground&&this.onDrawForeground(t,this.visible_rect),t.restore()}this.onDrawOverlay&&this.onDrawOverlay(t),this.dirty_area&&t.restore(),t.finish2D&&t.finish2D()}},a.prototype.renderInfo=function(t,e,i){e=e||0,i=i||0,t.save(),t.translate(e,i),t.font="10px Arial",t.fillStyle="#888",this.graph?(t.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13),t.fillText("I: "+this.graph.iteration,5,26),t.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,39),t.fillText("V: "+this.graph._version,5,52),t.fillText("FPS:"+this.fps.toFixed(2),5,65)):t.fillText("No graph selected",5,13),t.restore()},a.prototype.drawBackCanvas=function(){var t=this.bgcanvas;t.width==this.canvas.width&&t.height==this.canvas.height||(t.width=this.canvas.width,t.height=this.canvas.height),this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));var e=this.bgctx;if(e.start&&e.start(),this.clear_background&&e.clearRect(0,0,t.width,t.height),this._graph_stack&&this._graph_stack.length){e.save();this._graph_stack[this._graph_stack.length-1];var i=this.graph._subgraph_node;e.strokeStyle=i.bgcolor,e.lineWidth=10,e.strokeRect(1,1,t.width-2,t.height-2),e.lineWidth=1,e.font="40px Arial",e.textAlign="center",e.fillStyle=i.bgcolor||"#AAA";for(var n="",s=1;s<this._graph_stack.length;++s)n+=this._graph_stack[s]._subgraph_node.getTitle()+" >> ";e.fillText(n+i.getTitle(),.5*t.width,40),e.restore()}var o=!1;if(this.onRenderBackground&&(o=this.onRenderBackground(t,e)),e.restore(),e.setTransform(1,0,0,1,0,0),this.visible_links.length=0,this.graph){if(e.save(),this.ds.toCanvasContext(e),this.background_image&&this.ds.scale>.5&&!o){if(this.zoom_modify_alpha?e.globalAlpha=(1-.5/this.ds.scale)*this.editor_alpha:e.globalAlpha=this.editor_alpha,e.imageSmoothingEnabled=e.mozImageSmoothingEnabled=e.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;var r=this;this._bg_img.onload=function(){r.draw(!0,!0)}}var a=null;null==this._pattern&&this._bg_img.width>0?(a=e.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=a):a=this._pattern,a&&(e.fillStyle=a,e.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),e.fillStyle="transparent"),e.globalAlpha=1,e.imageSmoothingEnabled=e.mozImageSmoothingEnabled=e.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(t,e),this.onDrawBackground&&this.onDrawBackground(e,this.visible_area),this.onBackgroundRender&&(console.error("WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null),this.render_canvas_border&&(e.strokeStyle="#235",e.strokeRect(0,0,t.width,t.height)),this.render_connections_shadows?(e.shadowColor="#000",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=6):e.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(e),e.shadowColor="rgba(0,0,0,0)",e.restore()}e.finish&&e.finish(),this.dirty_bgcanvas=!1,this.dirty_canvas=!0};var u=new Float32Array(2);a.prototype.drawNode=function(t,i){this.current_node=t;var n=t.color||t.constructor.color||e.NODE_DEFAULT_COLOR,s=t.bgcolor||t.constructor.bgcolor||e.NODE_DEFAULT_BGCOLOR;if(t.mouseOver&&!0,this.live_mode)t.flags.collapsed||(i.shadowColor="transparent",t.onDrawForeground&&t.onDrawForeground(i,this,this.canvas));else{var o=this.editor_alpha;if(i.globalAlpha=o,this.render_shadows?(i.shadowColor=e.DEFAULT_SHADOW_COLOR,i.shadowOffsetX=2*this.ds.scale,i.shadowOffsetY=2*this.ds.scale,i.shadowBlur=3*this.ds.scale):i.shadowColor="transparent",!t.flags.collapsed||!t.onDrawCollapsed||1!=t.onDrawCollapsed(i,this)){var r=t._shape||e.BOX_SHAPE,a=u;u.set(t.size);var l=t.horizontal;if(t.flags.collapsed){i.font=this.inner_text_font;var h=t.getTitle?t.getTitle():t.title;null!=h&&(t._collapsed_width=Math.min(t.size[0],i.measureText(h).width+2*e.NODE_TITLE_HEIGHT),a[0]=t._collapsed_width,a[1]=0)}t.clip_area&&(i.save(),i.beginPath(),r==e.BOX_SHAPE?i.rect(0,0,a[0],a[1]):r==e.ROUND_SHAPE?i.roundRect(0,0,a[0],a[1],10):r==e.CIRCLE_SHAPE&&i.arc(.5*a[0],.5*a[1],.5*a[0],0,2*Math.PI),i.clip()),t.has_errors&&(s="red"),this.drawNodeShape(t,i,a,n,s,t.is_selected,t.mouseOver),i.shadowColor="transparent",t.onDrawForeground&&t.onDrawForeground(i,this,this.canvas),i.textAlign=l?"center":"left",i.font=this.inner_text_font;var p=this.ds.scale>.6,c=this.connecting_output;i.lineWidth=1;var d=0,_=new Float32Array(2);if(t.flags.collapsed){if(this.render_collapsed_slots){var g=null,f=null;if(t.inputs)for(y=0;y<t.inputs.length;y++){b=t.inputs[y];if(null!=b.link){g=b;break}}if(t.outputs)for(y=0;y<t.outputs.length;y++){b=t.outputs[y];b.links&&b.links.length&&(f=b)}if(g){var v=0,m=-.5*e.NODE_TITLE_HEIGHT;l&&(v=.5*t._collapsed_width,m=-e.NODE_TITLE_HEIGHT),i.fillStyle="#686",i.beginPath(),b.type===e.EVENT||b.shape===e.BOX_SHAPE?i.rect(v-7+.5,m-4,14,8):b.shape===e.ARROW_SHAPE?(i.moveTo(v+8,m),i.lineTo(v+-4,m-4),i.lineTo(v+-4,m+4),i.closePath()):i.arc(v,m,4,0,2*Math.PI),i.fill()}if(f){v=t._collapsed_width,m=-.5*e.NODE_TITLE_HEIGHT;l&&(v=.5*t._collapsed_width,m=0),i.fillStyle="#686",i.strokeStyle="black",i.beginPath(),b.type===e.EVENT||b.shape===e.BOX_SHAPE?i.rect(v-7+.5,m-4,14,8):b.shape===e.ARROW_SHAPE?(i.moveTo(v+6,m),i.lineTo(v-6,m-4),i.lineTo(v-6,m+4),i.closePath()):i.arc(v,m,4,0,2*Math.PI),i.fill()}}}else{if(t.inputs)for(var y=0;y<t.inputs.length;y++){var b=t.inputs[y];i.globalAlpha=o,this.connecting_node&&!e.isValidConnection(b.type,c.type)&&(i.globalAlpha=.4*o),i.fillStyle=null!=b.link?b.color_on||this.default_connection_color.input_on:b.color_off||this.default_connection_color.input_off;var E=t.getConnectionPos(!0,y,_);if(E[0]-=t.pos[0],E[1]-=t.pos[1],d<E[1]+.5*e.NODE_SLOT_HEIGHT&&(d=E[1]+.5*e.NODE_SLOT_HEIGHT),i.beginPath(),b.type===e.EVENT||b.shape===e.BOX_SHAPE?l?i.rect(E[0]-5+.5,E[1]-8+.5,10,14):i.rect(E[0]-6+.5,E[1]-5+.5,14,10):b.shape===e.ARROW_SHAPE?(i.moveTo(E[0]+8,E[1]+.5),i.lineTo(E[0]-4,E[1]+6+.5),i.lineTo(E[0]-4,E[1]-6+.5),i.closePath()):i.arc(E[0],E[1],4,0,2*Math.PI),i.fill(),p){var T=null!=b.label?b.label:b.name;T&&(i.fillStyle=e.NODE_TEXT_COLOR,l||b.dir==e.UP?i.fillText(T,E[0],E[1]-10):i.fillText(T,E[0]+10,E[1]+5))}}if(this.connecting_node&&(i.globalAlpha=.4*o),i.textAlign=l?"center":"right",i.strokeStyle="black",t.outputs)for(var y=0;y<t.outputs.length;y++){var b=t.outputs[y];E=t.getConnectionPos(!1,y,_);if(E[0]-=t.pos[0],E[1]-=t.pos[1],d<E[1]+.5*e.NODE_SLOT_HEIGHT&&(d=E[1]+.5*e.NODE_SLOT_HEIGHT),i.fillStyle=b.links&&b.links.length?b.color_on||this.default_connection_color.output_on:b.color_off||this.default_connection_color.output_off,i.beginPath(),b.type===e.EVENT||b.shape===e.BOX_SHAPE?l?i.rect(E[0]-5+.5,E[1]-8+.5,10,14):i.rect(E[0]-6+.5,E[1]-5+.5,14,10):b.shape===e.ARROW_SHAPE?(i.moveTo(E[0]+8,E[1]+.5),i.lineTo(E[0]-4,E[1]+6+.5),i.lineTo(E[0]-4,E[1]-6+.5),i.closePath()):i.arc(E[0],E[1],4,0,2*Math.PI),i.fill(),i.stroke(),p){T=null!=b.label?b.label:b.name;T&&(i.fillStyle=e.NODE_TEXT_COLOR,l||b.dir==e.DOWN?i.fillText(T,E[0],E[1]-8):i.fillText(T,E[0]-10,E[1]+5))}}i.textAlign="left",i.globalAlpha=1,t.widgets&&((l||t.widgets_up)&&(d=2),this.drawNodeWidgets(t,d,i,this.node_widget&&this.node_widget[0]==t?this.node_widget[1]:null))}t.clip_area&&i.restore(),i.globalAlpha=1}}},a.prototype.drawLinkTooltip=function(t,e){var i=e._pos;if(t.fillStyle="black",t.beginPath(),t.arc(i[0],i[1],3,0,2*Math.PI),t.fill(),null!=e.data&&(!this.onDrawLinkTooltip||1!=this.onDrawLinkTooltip(t,e,this))){var n=e.data,s=null;if(s=n.constructor===Number?n.toFixed(2):n.constructor===String?'"'+n+'"':n.constructor===Boolean?String(n):n.toToolTip?n.toToolTip():"["+n.constructor.name+"]",null!=s){t.font="14px Courier New";var o=t.measureText(s),r=o.width+20,a=24;t.shadowColor="black",t.shadowOffsetX=2,t.shadowOffsetY=2,t.shadowBlur=3,t.fillStyle="#454",t.beginPath(),t.roundRect(i[0]-.5*r,i[1]-15-a,r,a,3,3),t.moveTo(i[0]-10,i[1]-15),t.lineTo(i[0]+10,i[1]-15),t.lineTo(i[0],i[1]-5),t.fill(),t.shadowColor="transparent",t.textAlign="center",t.fillStyle="#CEC",t.fillText(s,i[0],i[1]-15-.3*a)}}};var h=new Float32Array(4);a.prototype.drawNodeShape=function(t,i,n,s,o,r,l){i.strokeStyle=s,i.fillStyle=o;var u=e.NODE_TITLE_HEIGHT,p=this.ds.scale<.5,c=t._shape||t.constructor.shape||e.ROUND_SHAPE,d=t.constructor.title_mode,_=!0;d==e.TRANSPARENT_TITLE?_=!1:d==e.AUTOHIDE_TITLE&&l&&(_=!0);var g=h;g[0]=0,g[1]=_?-u:0,g[2]=n[0]+1,g[3]=_?n[1]+u:n[1];var f=i.globalAlpha;if(i.beginPath(),c==e.BOX_SHAPE||p?i.fillRect(g[0],g[1],g[2],g[3]):c==e.ROUND_SHAPE||c==e.CARD_SHAPE?i.roundRect(g[0],g[1],g[2],g[3],this.round_radius,c==e.CARD_SHAPE?0:this.round_radius):c==e.CIRCLE_SHAPE&&i.arc(.5*n[0],.5*n[1],.5*n[0],0,2*Math.PI),i.fill(),t.flags.collapsed||(i.shadowColor="transparent",i.fillStyle="rgba(0,0,0,0.2)",i.fillRect(0,-1,g[2],2)),i.shadowColor="transparent",t.onDrawBackground&&t.onDrawBackground(i,this,this.canvas),_||d==e.TRANSPARENT_TITLE){if(t.onDrawTitleBar)t.onDrawTitleBar(i,u,n,this.ds.scale,s);else if(d!=e.TRANSPARENT_TITLE&&(t.constructor.title_color||this.render_title_colored)){var v=t.constructor.title_color||s;if(t.flags.collapsed&&(i.shadowColor=e.DEFAULT_SHADOW_COLOR),this.use_gradients){var m=a.gradients[v];m||(m=a.gradients[v]=i.createLinearGradient(0,0,400,0),m.addColorStop(0,v),m.addColorStop(1,"#000")),i.fillStyle=m}else i.fillStyle=v;i.beginPath(),c==e.BOX_SHAPE||p?i.rect(0,-u,n[0]+1,u):c!=e.ROUND_SHAPE&&c!=e.CARD_SHAPE||i.roundRect(0,-u,n[0]+1,u,this.round_radius,t.flags.collapsed?this.round_radius:0),i.fill(),i.shadowColor="transparent"}var y=10;if(t.onDrawTitleBox?t.onDrawTitleBox(i,u,n,this.ds.scale):c==e.ROUND_SHAPE||c==e.CIRCLE_SHAPE||c==e.CARD_SHAPE?(p&&(i.fillStyle="black",i.beginPath(),i.arc(.5*u,-.5*u,.5*y+1,0,2*Math.PI),i.fill()),i.fillStyle=t.boxcolor||e.NODE_DEFAULT_BOXCOLOR,i.beginPath(),i.arc(.5*u,-.5*u,.5*y,0,2*Math.PI),i.fill()):(p&&(i.fillStyle="black",i.fillRect(.5*(u-y)-1,-.5*(u+y)-1,y+2,y+2)),i.fillStyle=t.boxcolor||e.NODE_DEFAULT_BOXCOLOR,i.fillRect(.5*(u-y),-.5*(u+y),y,y)),i.globalAlpha=f,t.onDrawTitleText&&t.onDrawTitleText(i,u,n,this.ds.scale,this.title_text_font,r),!p){i.font=this.title_text_font;var b=t.getTitle();if(b)if(i.fillStyle=r?"white":t.constructor.title_text_color||this.node_title_color,t.flags.collapsed){i.textAlign="center";var E=i.measureText(b);i.fillText(b,u+.5*E.width,e.NODE_TITLE_TEXT_Y-u),i.textAlign="left"}else i.textAlign="left",i.fillText(b,u,e.NODE_TITLE_TEXT_Y-u)}t.onDrawTitle&&t.onDrawTitle(i)}r&&(t.onBounding&&t.onBounding(g),d==e.TRANSPARENT_TITLE&&(g[1]-=u,g[3]+=u),i.lineWidth=1,i.globalAlpha=.8,i.beginPath(),c==e.BOX_SHAPE?i.rect(-6+g[0],-6+g[1],12+g[2],12+g[3]):c==e.ROUND_SHAPE||c==e.CARD_SHAPE&&t.flags.collapsed?i.roundRect(-6+g[0],-6+g[1],12+g[2],12+g[3],2*this.round_radius):c==e.CARD_SHAPE?i.roundRect(-6+g[0],-6+g[1],12+g[2],12+g[3],2*this.round_radius,2):c==e.CIRCLE_SHAPE&&i.arc(.5*n[0],.5*n[1],.5*n[0]+6,0,2*Math.PI),i.strokeStyle="#FFF",i.stroke(),i.strokeStyle=s,i.globalAlpha=1)};var p=new Float32Array(4),c=new Float32Array(4),d=new Float32Array(2),_=new Float32Array(2);function g(t,e){for(var i in t)if(t[i]!=e[i])return!1;return!0}function f(t,e){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}function v(t){return"rgba("+Math.round(255*t[0]).toFixed()+","+Math.round(255*t[1]).toFixed()+","+Math.round(255*t[2]).toFixed()+","+(4==t.length?t[3].toFixed(2):"1.0")+")"}function m(t,e,i,n,s,o){return i<t&&i+s>t&&n<e&&n+o>e}function y(t,e,i){e<t[0]?t[0]=e:e>t[2]&&(t[2]=e),i<t[1]?t[1]=i:i>t[3]&&(t[3]=i)}function b(t,e){return!(t[0]<e[0][0]||t[1]<e[0][1]||t[0]>e[1][0]||t[1]>e[1][1])}function E(t,e){var i=t[0]+t[2],n=t[1]+t[3],s=e[0]+e[2],o=e[1]+e[3];return!(t[0]>s||t[1]>o||i<e[0]||n<e[1])}function T(t){"#"==t.charAt(0)&&(t=t.slice(1)),t=t.toUpperCase();for(var e,i,n="0123456789ABCDEF",s=new Array(3),o=0,r=0;r<6;r+=2)e=n.indexOf(t.charAt(r)),i=n.indexOf(t.charAt(r+1)),s[o]=16*e+i,o++;return s}function w(t){for(var e,i,n="0123456789ABCDEF",s="#",o=0;o<3;o++)e=t[o]/16,i=t[o]%16,s+=n.charAt(e)+n.charAt(i);return s}function O(t,e){e=e||{},this.options=e;var i=this;e.parentMenu&&(e.parentMenu.constructor!==this.constructor?(console.error("parentMenu must be of class ContextMenu, ignoring it"),e.parentMenu=null):(this.parentMenu=e.parentMenu,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this)),e.event&&e.event.constructor!==MouseEvent&&e.event.constructor!==CustomEvent&&(console.error("Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it."),e.event=null);var n=document.createElement("div");function s(t){var i=parseInt(n.style.top);return n.style.top=(i+t.deltaY*e.scroll_speed).toFixed()+"px",t.preventDefault(),!0}if(n.className="litegraph litecontextmenu litemenubar-panel",e.className&&(n.className+=" "+e.className),n.style.minWidth=100,n.style.minHeight=100,n.style.pointerEvents="none",setTimeout((function(){n.style.pointerEvents="auto"}),100),n.addEventListener("mouseup",(function(t){return t.preventDefault(),!0}),!0),n.addEventListener("contextmenu",(function(t){return 2==t.button&&(t.preventDefault(),!1)}),!0),n.addEventListener("mousedown",(function(t){if(2==t.button)return i.close(),t.preventDefault(),!0}),!0),e.scroll_speed||(e.scroll_speed=.1),n.addEventListener("wheel",s,!0),n.addEventListener("mousewheel",s,!0),this.root=n,e.title){var o=document.createElement("div");o.className="litemenu-title",o.innerHTML=e.title,n.appendChild(o)}for(var r in t){var a=t.constructor==Array?t[r]:r;null!=a&&a.constructor!==String&&(a=void 0===a.content?String(a):a.content);var l=t[r];this.addItem(a,l,e)}n.addEventListener("mouseleave",(function(t){i.lock||(n.closing_timer&&clearTimeout(n.closing_timer),n.closing_timer=setTimeout(i.close.bind(i,t),500))})),n.addEventListener("mouseenter",(function(t){n.closing_timer&&clearTimeout(n.closing_timer)}));var u=document;e.event&&(u=e.event.target.ownerDocument),u||(u=document),u.body.appendChild(n);var h=e.left||0,p=e.top||0;if(e.event){if(h=e.event.clientX-10,p=e.event.clientY-10,e.title&&(p-=20),e.parentMenu){var c=e.parentMenu.root.getBoundingClientRect();h=c.left+c.width}var d=document.body.getBoundingClientRect(),_=n.getBoundingClientRect();h>d.width-_.width-10&&(h=d.width-_.width-10),p>d.height-_.height-10&&(p=d.height-_.height-10)}n.style.left=h+"px",n.style.top=p+"px",e.scale&&(n.style.transform="scale("+e.scale+")")}function C(){this.size=[140,80],this.properties={enabled:!0},this.enabled=!0,this.subgraph=new i,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.onTrigger=this.onSubgraphTrigger.bind(this),this.subgraph.onInputAdded=this.onSubgraphNewInput.bind(this),this.subgraph.onInputRenamed=this.onSubgraphRenamedInput.bind(this),this.subgraph.onInputTypeChanged=this.onSubgraphTypeChangeInput.bind(this),this.subgraph.onInputRemoved=this.onSubgraphRemovedInput.bind(this),this.subgraph.onOutputAdded=this.onSubgraphNewOutput.bind(this),this.subgraph.onOutputRenamed=this.onSubgraphRenamedOutput.bind(this),this.subgraph.onOutputTypeChanged=this.onSubgraphTypeChangeOutput.bind(this),this.subgraph.onOutputRemoved=this.onSubgraphRemovedOutput.bind(this)}function D(){this.addOutput("","number"),this.name_in_graph="",this.properties={name:"",type:"number",value:0};var t=this;this.name_widget=this.addWidget("text","Name",this.properties.name,(function(e){e&&t.setProperty("name",e)})),this.type_widget=this.addWidget("text","Type",this.properties.type,(function(e){t.setProperty("type",e)})),this.value_widget=this.addWidget("number","Value",this.properties.value,(function(e){t.setProperty("value",e)})),this.widgets_up=!0,this.size=[180,90]}function k(){this.addInput("",""),this.name_in_graph="",this.properties={};var t=this;Object.defineProperty(this.properties,"name",{get:function(){return t.name_in_graph},set:function(e){""!=e&&e!=t.name_in_graph&&(t.name_in_graph?t.graph.renameOutput(t.name_in_graph,e):t.graph.addOutput(e,t.properties.type),t.name_widget.value=e,t.name_in_graph=e)},enumerable:!0}),Object.defineProperty(this.properties,"type",{get:function(){return t.inputs[0].type},set:function(i){"action"!=i&&"event"!=i||(i=e.ACTION),t.inputs[0].type=i,t.name_in_graph&&t.graph.changeOutputType(t.name_in_graph,t.inputs[0].type),t.type_widget.value=i||""},enumerable:!0}),this.name_widget=this.addWidget("text","Name",this.properties.name,(function(e){e&&(t.properties.name=e)})),this.type_widget=this.addWidget("text","Type",this.properties.type,(function(e){e=e||"",t.properties.type=e})),this.widgets_up=!0,this.size=[180,60]}a.prototype.drawConnections=function(t){var i=e.getTime(),n=this.visible_area;p[0]=n[0]-20,p[1]=n[1]-20,p[2]=n[2]+40,p[3]=n[3]+40,t.lineWidth=this.connections_width,t.fillStyle="#AAA",t.strokeStyle="#AAA",t.globalAlpha=this.editor_alpha;for(var s=this.graph._nodes,o=0,r=s.length;o<r;++o){var a=s[o];if(a.inputs&&a.inputs.length)for(var l=0;l<a.inputs.length;++l){var u=a.inputs[l];if(u&&null!=u.link){var h=u.link,g=this.graph.links[h];if(g){var f=this.graph.getNodeById(g.origin_id);if(null!=f){var v=g.origin_slot,m=null;m=-1==v?[f.pos[0]+10,f.pos[1]+10]:f.getConnectionPos(!1,v,d);var y=a.getConnectionPos(!0,l,_);if(c[0]=m[0],c[1]=m[1],c[2]=y[0]-m[0],c[3]=y[1]-m[1],c[2]<0&&(c[0]+=c[2],c[2]=Math.abs(c[2])),c[3]<0&&(c[1]+=c[3],c[3]=Math.abs(c[3])),E(c,p)){var b=f.outputs[v],T=a.inputs[l];if(b&&T){var w=b.dir||(f.horizontal?e.DOWN:e.RIGHT),O=T.dir||(a.horizontal?e.UP:e.LEFT);if(this.renderLink(t,m,y,g,!1,0,null,w,O),g&&g._last_time&&i-g._last_time<1e3){var C=2-.002*(i-g._last_time),D=t.globalAlpha;t.globalAlpha=D*C,this.renderLink(t,m,y,g,!0,C,"white",w,O),t.globalAlpha=D}}}}}}}}t.globalAlpha=1},a.prototype.renderLink=function(t,i,n,s,o,r,l,u,h,p){s&&this.visible_links.push(s),!l&&s&&(l=s.color||a.link_type_colors[s.type]),l||(l=this.default_link_color),null!=s&&this.highlighted_links[s.id]&&(l="#FFF"),u=u||e.RIGHT,h=h||e.LEFT;var c=f(i,n);this.render_connections_border&&this.ds.scale>.6&&(t.lineWidth=this.connections_width+4),t.lineJoin="round",p=p||1,p>1&&(t.lineWidth=.5),t.beginPath();for(var d=0;d<p;d+=1){var _=5*(d-.5*(p-1));if(this.links_render_mode==e.SPLINE_LINK){t.moveTo(i[0],i[1]+_);var g=0,v=0,m=0,y=0;switch(u){case e.LEFT:g=-.25*c;break;case e.RIGHT:g=.25*c;break;case e.UP:v=-.25*c;break;case e.DOWN:v=.25*c;break}switch(h){case e.LEFT:m=-.25*c;break;case e.RIGHT:m=.25*c;break;case e.UP:y=-.25*c;break;case e.DOWN:y=.25*c;break}t.bezierCurveTo(i[0]+g,i[1]+v+_,n[0]+m,n[1]+y+_,n[0],n[1]+_)}else if(this.links_render_mode==e.LINEAR_LINK){t.moveTo(i[0],i[1]+_);g=0,v=0,m=0,y=0;switch(u){case e.LEFT:g=-1;break;case e.RIGHT:g=1;break;case e.UP:v=-1;break;case e.DOWN:v=1;break}switch(h){case e.LEFT:m=-1;break;case e.RIGHT:m=1;break;case e.UP:y=-1;break;case e.DOWN:y=1;break}var b=15;t.lineTo(i[0]+g*b,i[1]+v*b+_),t.lineTo(n[0]+m*b,n[1]+y*b+_),t.lineTo(n[0],n[1]+_)}else{if(this.links_render_mode!=e.STRAIGHT_LINK)return;t.moveTo(i[0],i[1]);var E=i[0],T=i[1],w=n[0],O=n[1];u==e.RIGHT?E+=10:T+=10,h==e.LEFT?w-=10:O-=10,t.lineTo(E,T),t.lineTo(.5*(E+w),T),t.lineTo(.5*(E+w),O),t.lineTo(w,O),t.lineTo(n[0],n[1])}}this.render_connections_border&&this.ds.scale>.6&&!o&&(t.strokeStyle="rgba(0,0,0,0.5)",t.stroke()),t.lineWidth=this.connections_width,t.fillStyle=t.strokeStyle=l,t.stroke();var C=this.computeConnectionPoint(i,n,.5,u,h);if(s&&s._pos&&(s._pos[0]=C[0],s._pos[1]=C[1]),this.ds.scale>=.6&&this.highquality_render&&h!=e.CENTER){if(this.render_connection_arrows){var D=this.computeConnectionPoint(i,n,.25,u,h),k=this.computeConnectionPoint(i,n,.26,u,h),I=this.computeConnectionPoint(i,n,.75,u,h),N=this.computeConnectionPoint(i,n,.76,u,h),x=0,S=0;this.render_curved_connections?(x=-Math.atan2(k[0]-D[0],k[1]-D[1]),S=-Math.atan2(N[0]-I[0],N[1]-I[1])):S=x=n[1]>i[1]?0:Math.PI,t.save(),t.translate(D[0],D[1]),t.rotate(x),t.beginPath(),t.moveTo(-5,-3),t.lineTo(0,7),t.lineTo(5,-3),t.fill(),t.restore(),t.save(),t.translate(I[0],I[1]),t.rotate(S),t.beginPath(),t.moveTo(-5,-3),t.lineTo(0,7),t.lineTo(5,-3),t.fill(),t.restore()}t.beginPath(),t.arc(C[0],C[1],5,0,2*Math.PI),t.fill()}if(r){t.fillStyle=l;for(d=0;d<5;++d){var A=(.001*e.getTime()+.2*d)%1;C=this.computeConnectionPoint(i,n,A,u,h);t.beginPath(),t.arc(C[0],C[1],5,0,2*Math.PI),t.fill()}}},a.prototype.computeConnectionPoint=function(t,i,n,s,o){s=s||e.RIGHT,o=o||e.LEFT;var r=f(t,i),a=t,l=[t[0],t[1]],u=[i[0],i[1]],h=i;switch(s){case e.LEFT:l[0]+=-.25*r;break;case e.RIGHT:l[0]+=.25*r;break;case e.UP:l[1]+=-.25*r;break;case e.DOWN:l[1]+=.25*r;break}switch(o){case e.LEFT:u[0]+=-.25*r;break;case e.RIGHT:u[0]+=.25*r;break;case e.UP:u[1]+=-.25*r;break;case e.DOWN:u[1]+=.25*r;break}var p=(1-n)*(1-n)*(1-n),c=(1-n)*(1-n)*3*n,d=3*(1-n)*(n*n),_=n*n*n,g=p*a[0]+c*l[0]+d*u[0]+_*h[0],v=p*a[1]+c*l[1]+d*u[1]+_*h[1];return[g,v]},a.prototype.drawExecutionOrder=function(t){t.shadowColor="transparent",t.globalAlpha=.25,t.textAlign="center",t.strokeStyle="white",t.globalAlpha=.75;for(var i=this.visible_nodes,n=0;n<i.length;++n){var s=i[n];t.fillStyle="black",t.fillRect(s.pos[0]-e.NODE_TITLE_HEIGHT,s.pos[1]-e.NODE_TITLE_HEIGHT,e.NODE_TITLE_HEIGHT,e.NODE_TITLE_HEIGHT),0==s.order&&t.strokeRect(s.pos[0]-e.NODE_TITLE_HEIGHT+.5,s.pos[1]-e.NODE_TITLE_HEIGHT+.5,e.NODE_TITLE_HEIGHT,e.NODE_TITLE_HEIGHT),t.fillStyle="#FFF",t.fillText(s.order,s.pos[0]+-.5*e.NODE_TITLE_HEIGHT,s.pos[1]-6)}t.globalAlpha=1},a.prototype.drawNodeWidgets=function(t,i,n,s){if(!t.widgets||!t.widgets.length)return 0;var o=t.size[0],r=t.widgets;i+=2;var a=e.NODE_WIDGET_HEIGHT,l=this.ds.scale>.5;n.save(),n.globalAlpha=this.editor_alpha;for(var u=e.WIDGET_OUTLINE_COLOR,h=e.WIDGET_BGCOLOR,p=e.WIDGET_TEXT_COLOR,c=e.WIDGET_SECONDARY_TEXT_COLOR,d=15,_=0;_<r.length;++_){var g=r[_],f=i;switch(g.y&&(f=g.y),g.last_y=f,n.strokeStyle=u,n.fillStyle="#222",n.textAlign="left",g.type){case"button":g.clicked&&(n.fillStyle="#AAA",g.clicked=!1,this.dirty_canvas=!0),n.fillRect(d,f,o-2*d,a),n.strokeRect(d,f,o-2*d,a),l&&(n.textAlign="center",n.fillStyle=p,n.fillText(g.name,.5*o,f+.7*a));break;case"toggle":n.textAlign="left",n.strokeStyle=u,n.fillStyle=h,n.beginPath(),n.roundRect(d,i,o-2*d,a,.5*a),n.fill(),n.stroke(),n.fillStyle=g.value?"#89A":"#333",n.beginPath(),n.arc(o-2*d,f+.5*a,.36*a,0,2*Math.PI),n.fill(),l&&(n.fillStyle=c,null!=g.name&&n.fillText(g.name,2*d,f+.7*a),n.fillStyle=g.value?p:c,n.textAlign="right",n.fillText(g.value?g.options.on||"true":g.options.off||"false",o-40,f+.7*a));break;case"slider":n.fillStyle=h,n.fillRect(d,f,o-2*d,a);var v=g.options.max-g.options.min,m=(g.value-g.options.min)/v;if(n.fillStyle=s==g?"#89A":"#678",n.fillRect(d,f,m*(o-2*d),a),n.strokeRect(d,f,o-2*d,a),g.marker){var y=(g.marker-g.options.min)/v;n.fillStyle="#AA9",n.fillRect(d+y*(o-2*d),f,2,a)}l&&(n.textAlign="center",n.fillStyle=p,n.fillText(g.name+"  "+Number(g.value).toFixed(3),.5*o,f+.7*a));break;case"number":case"combo":n.textAlign="left",n.strokeStyle=u,n.fillStyle=h,n.beginPath(),n.roundRect(d,i,o-2*d,a,.5*a),n.fill(),n.stroke(),l&&(n.fillStyle=p,n.beginPath(),n.moveTo(d+16,i+5),n.lineTo(d+6,i+.5*a),n.lineTo(d+16,i+a-5),n.moveTo(o-d-16,i+5),n.lineTo(o-d-6,i+.5*a),n.lineTo(o-d-16,i+a-5),n.fill(),n.fillStyle=c,n.fillText(g.name,2*d+5,f+.7*a),n.fillStyle=p,n.textAlign="right","number"==g.type?n.fillText(Number(g.value).toFixed(void 0!==g.options.precision?g.options.precision:3),o-2*d-20,f+.7*a):n.fillText(g.value,o-2*d-20,f+.7*a));break;case"string":case"text":n.textAlign="left",n.strokeStyle=u,n.fillStyle=h,n.beginPath(),n.roundRect(d,i,o-2*d,a,.5*a),n.fill(),n.stroke(),l&&(n.fillStyle=c,null!=g.name&&n.fillText(g.name,2*d,f+.7*a),n.fillStyle=p,n.textAlign="right",n.fillText(g.value,o-2*d,f+.7*a));break;default:g.draw&&g.draw(n,t,g,f,a);break}i+=a+4}n.restore()},a.prototype.processNodeWidgets=function(t,i,n,s){if(!t.widgets||!t.widgets.length)return null;for(var o=i[0]-t.pos[0],r=i[1]-t.pos[1],a=t.size[0],l=this,u=this.getCanvasWindow(),h=0;h<t.widgets.length;++h){var p=t.widgets[h];if(p==s||o>6&&o<a-12&&r>p.last_y&&r<p.last_y+e.NODE_WIDGET_HEIGHT){switch(p.type){case"button":if("mousemove"===n.type)break;p.callback&&setTimeout((function(){p.callback(p,l,t,i)}),20),p.clicked=!0,this.dirty_canvas=!0;break;case"slider":p.options.max,p.options.min;var c=Math.clamp((o-10)/(a-20),0,1);p.value=p.options.min+(p.options.max-p.options.min)*c,p.callback&&setTimeout((function(){v(p,p.value)}),20),this.dirty_canvas=!0;break;case"number":case"combo":if("mousemove"==n.type&&"number"==p.type)p.value+=.1*n.deltaX*(p.options.step||1),null!=p.options.min&&p.value<p.options.min&&(p.value=p.options.min),null!=p.options.max&&p.value>p.options.max&&(p.value=p.options.max);else if("mousedown"==n.type){var d=p.options.values;d&&d.constructor===Function&&(d=p.options.values(p,t));var _=o<40?-1:o>a-40?1:0;if("number"==p.type)p.value+=.1*_*(p.options.step||1),null!=p.options.min&&p.value<p.options.min&&(p.value=p.options.min),null!=p.options.max&&p.value>p.options.max&&(p.value=p.options.max);else if(_){var g=d.indexOf(p.value)+_;g>=d.length&&(g=0),g<0&&(g=d.length-1),p.value=d[g]}else{new e.ContextMenu(d,{scale:Math.max(1,this.ds.scale),event:n,className:"dark",callback:f.bind(p)},u);function f(t,e,i){return this.value=t,v(this,t),l.dirty_canvas=!0,!1}}}setTimeout(function(){v(this,this.value)}.bind(p),20),this.dirty_canvas=!0;break;case"toggle":"mousedown"==n.type&&(p.value=!p.value,p.callback&&setTimeout((function(){v(p,p.value)}),20));break;case"string":case"text":"mousedown"==n.type&&this.prompt("Value",p.value,function(t){this.value=t,v(this,t)}.bind(p),n);break;default:p.mouse&&p.mouse(ctx,n,[o,r],t);break}return p}}function v(e,s){e.value=s,e.property&&void 0!==t.properties[e.property]&&(t.properties[e.property]=s),e.callback&&e.callback(e.value,l,t,i,n)}return null},a.prototype.drawGroups=function(t,i){if(this.graph){var n=this.graph._groups;i.save(),i.globalAlpha=.5*this.editor_alpha;for(var s=0;s<n.length;++s){var o=n[s];if(E(this.visible_area,o._bounding)){i.fillStyle=o.color||"#335",i.strokeStyle=o.color||"#335";var r=o._pos,a=o._size;i.globalAlpha=.25*this.editor_alpha,i.beginPath(),i.rect(r[0]+.5,r[1]+.5,a[0],a[1]),i.fill(),i.globalAlpha=this.editor_alpha,i.stroke(),i.beginPath(),i.moveTo(r[0]+a[0],r[1]+a[1]),i.lineTo(r[0]+a[0]-10,r[1]+a[1]),i.lineTo(r[0]+a[0],r[1]+a[1]-10),i.fill();var l=o.font_size||e.DEFAULT_GROUP_FONT_SIZE;i.font=l+"px Arial",i.fillText(o.title,r[0]+4,r[1]+l)}}i.restore()}},a.prototype.adjustNodesSize=function(){for(var t=this.graph._nodes,e=0;e<t.length;++e)t[e].size=t[e].computeSize();this.setDirty(!0,!0)},a.prototype.resize=function(t,e){if(!t&&!e){var i=this.canvas.parentNode;t=i.offsetWidth,e=i.offsetHeight}this.canvas.width==t&&this.canvas.height==e||(this.canvas.width=t,this.canvas.height=e,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0))},a.prototype.switchLiveMode=function(t){if(!t)return this.live_mode=!this.live_mode,this.dirty_canvas=!0,void(this.dirty_bgcanvas=!0);var e=this,i=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var n=setInterval((function(){e.editor_alpha*=i,e.dirty_canvas=!0,e.dirty_bgcanvas=!0,i<1&&e.editor_alpha<.01&&(clearInterval(n),i<1&&(e.live_mode=!0)),i>1&&e.editor_alpha>.99&&(clearInterval(n),e.editor_alpha=1)}),1)},a.prototype.onNodeSelectionChange=function(t){},a.prototype.touchHandler=function(t){var e=t.changedTouches,i=e[0],n="";switch(t.type){case"touchstart":n="mousedown";break;case"touchmove":n="mousemove";break;case"touchend":n="mouseup";break;default:return}var s=this.getCanvasWindow(),o=s.document,r=o.createEvent("MouseEvent");r.initMouseEvent(n,!0,!0,s,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),i.target.dispatchEvent(r),t.preventDefault()},a.onGroupAdd=function(t,i,n){var s=a.active_canvas,o=(s.getCanvasWindow(),new e.LGraphGroup);o.pos=s.convertEventToCanvasOffset(n),s.graph.add(o)},a.onMenuAdd=function(t,i,n,s){var o=a.active_canvas,r=o.getCanvasWindow(),l=e.getNodeTypesCategories(o.filter),u=[];for(var h in l)l[h]&&u.push({value:l[h],content:l[h],has_submenu:!0});var p=new e.ContextMenu(u,{event:n,callback:c,parentMenu:s},r);function c(t,i,n){var s=t.value,a=e.getNodeTypesInCategory(s,o.filter),l=[];for(var u in a)a[u].skip_list||l.push({content:a[u].title,value:a[u].type});return new e.ContextMenu(l,{event:n,callback:d,parentMenu:p},r),!1}function d(t,i){var n=s.getFirstEvent(),r=e.createNode(t.value);r&&(r.pos=o.convertEventToCanvasOffset(n),o.graph.add(r))}return!1},a.onMenuCollapseAll=function(){},a.onMenuNodeEdit=function(){},a.showMenuNodeOptionalInputs=function(t,i,n,s,o){if(o){var r=this,l=a.active_canvas,u=l.getCanvasWindow();i=o.optional_inputs;o.onGetInputs&&(i=o.onGetInputs());var h=[];if(i)for(var p in i){var c=i[p];if(c){var d=c[0];c[2]&&c[2].label&&(d=c[2].label);var _={content:d,value:c};c[1]==e.ACTION&&(_.className="event"),h.push(_)}else h.push(null)}if(this.onMenuNodeInputs&&(h=this.onMenuNodeInputs(h)),h.length){new e.ContextMenu(h,{event:n,callback:g,parentMenu:s,node:o},u);return!1}}function g(t,e,i){o&&(t.callback&&t.callback.call(r,o,t,e,i),t.value&&(o.addInput(t.value[0],t.value[1],t.value[2]),o.setDirtyCanvas(!0,!0)))}},a.showMenuNodeOptionalOutputs=function(t,i,n,s,o){if(o){var r=this,l=a.active_canvas,u=l.getCanvasWindow();i=o.optional_outputs;o.onGetOutputs&&(i=o.onGetOutputs());var h=[];if(i)for(var p in i){var c=i[p];if(c){if(!o.flags||!o.flags.skip_repeated_outputs||-1==o.findOutputSlot(c[0])){var d=c[0];c[2]&&c[2].label&&(d=c[2].label);var _={content:d,value:c};c[1]==e.EVENT&&(_.className="event"),h.push(_)}}else h.push(null)}if(this.onMenuNodeOutputs&&(h=this.onMenuNodeOutputs(h)),h.length){new e.ContextMenu(h,{event:n,callback:g,parentMenu:s,node:o},u);return!1}}function g(t,i,n){if(o&&(t.callback&&t.callback.call(r,o,t,i,n),t.value)){var a=t.value[1];if(a&&(a.constructor===Object||a.constructor===Array)){var l=[];for(var u in a)l.push({content:u,value:a[u]});return new e.ContextMenu(l,{event:i,callback:g,parentMenu:s,node:o}),!1}o.addOutput(t.value[0],t.value[1],t.value[2]),o.setDirtyCanvas(!0,!0)}}},a.onShowMenuNodeProperties=function(t,i,n,s,o){if(o&&o.properties){var r=a.active_canvas,l=r.getCanvasWindow(),u=[];for(var h in o.properties){t=void 0!==o.properties[h]?o.properties[h]:" ";t=a.decodeHTML(t),u.push({content:"<span class='property_name'>"+h+"</span><span class='property_value'>"+t+"</span>",value:h})}if(u.length){new e.ContextMenu(u,{event:n,callback:p,parentMenu:s,allow_html:!0,node:o},l);return!1}}function p(t,e,i,n){if(o){var s=this.getBoundingClientRect();r.showEditPropertyValue(o,t.value,{position:[s.left,s.top]})}}},a.decodeHTML=function(t){var e=document.createElement("div");return e.innerText=t,e.innerHTML},a.onResizeNode=function(t,e,i,n,s){s&&(s.size=s.computeSize(),s.setDirtyCanvas(!0,!0))},a.prototype.showLinkMenu=function(t,i){var n=this;function s(e){switch(e){case"Delete":n.graph.removeLink(t.id);break;default:}}return console.log(t.data),new e.ContextMenu(["Delete"],{event:i,title:null!=t.data?t.data.constructor.name:null,callback:s}),!1},a.onShowPropertyEditor=function(t,e,i,n,s){var o=t.property||"title",r=s[o],l=document.createElement("div");l.className="graphdialog",l.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>";var u=l.querySelector(".name");u.innerText=o;var h=l.querySelector("input");h&&(h.value=r,h.addEventListener("blur",(function(t){this.focus()})),h.addEventListener("keydown",(function(t){13==t.keyCode&&(g(),t.preventDefault(),t.stopPropagation())})));var p=a.active_canvas,c=p.canvas,d=c.getBoundingClientRect();d&&(d.left,d.top),event,l.style.left="100px",l.style.top="100px";var _=l.querySelector("button");function g(){f(h.value)}function f(e){"Number"==t.type?e=Number(e):"Boolean"==t.type&&(e=Boolean(e)),s[o]=e,l.parentNode&&l.parentNode.removeChild(l),s.setDirtyCanvas(!0,!0)}_.addEventListener("click",g),c.parentNode.appendChild(l)},a.prototype.prompt=function(t,e,i,n){var s=this;t=t||"";var o=!1,r=document.createElement("div");r.className="graphdialog rounded",r.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",r.close=function(){s.prompt_box=null,r.parentNode&&r.parentNode.removeChild(r)},this.ds.scale>1&&(r.style.transform="scale("+this.ds.scale+")"),r.addEventListener("mouseleave",(function(t){o||r.close()})),s.prompt_box&&s.prompt_box.close(),s.prompt_box=r;var l=r.querySelector(".name");l.innerText=t;var u=r.querySelector(".value");u.value=e;var h=r.querySelector("input");h.addEventListener("keydown",(function(t){if(o=!0,27==t.keyCode)r.close();else{if(13!=t.keyCode)return;i&&i(this.value),r.close()}t.preventDefault(),t.stopPropagation()}));var p=r.querySelector("button");p.addEventListener("click",(function(t){i&&i(h.value),s.setDirty(!0),r.close()}));var c=a.active_canvas,d=c.canvas,_=d.getBoundingClientRect();return _&&(_.left,_.top),r.style.left="100px",r.style.top="100px",d.parentNode.appendChild(r),setTimeout((function(){h.focus()}),10),r},a.search_limit=-1,a.prototype.showSearchBox=function(t){var i=this,n=document.createElement("div");n.className="litegraph litesearchbox graphdialog rounded",n.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/><div class='helper'></div>",n.close=function(){i.search_box=null,document.body.focus(),setTimeout((function(){i.canvas.focus()}),20),n.parentNode&&n.parentNode.removeChild(n)};var s=null;this.ds.scale>1&&(n.style.transform="scale("+this.ds.scale+")"),n.addEventListener("mouseenter",(function(t){s&&(clearTimeout(s),s=null)})),n.addEventListener("mouseleave",(function(t){s=setTimeout((function(){n.close()}),500)})),i.search_box&&i.search_box.close(),i.search_box=n;var o=n.querySelector(".helper"),r=null,l=null,u=null,h=n.querySelector("input");h&&(h.addEventListener("blur",(function(t){this.focus()})),h.addEventListener("keydown",(function(t){if(38==t.keyCode)g(!1);else if(40==t.keyCode)g(!0);else if(27==t.keyCode)n.close();else{if(13!=t.keyCode)return l&&clearInterval(l),void(l=setTimeout(f,10));u?_(u.innerHTML):r?_(r):n.close()}t.preventDefault(),t.stopPropagation()})));var p=a.active_canvas,c=p.canvas,d=c.getBoundingClientRect();function _(s){if(s)if(i.onSearchBoxSelection)i.onSearchBoxSelection(s,t,p);else{var o=e.searchbox_extras[s.toLowerCase()];o&&(s=o.type);var r=e.createNode(s);if(r&&(r.pos=p.convertEventToCanvasOffset(t),p.graph.add(r)),o&&o.data){if(o.data.properties)for(var a in o.data.properties)r.addProperty(a,o.data.properties[a]);if(o.data.inputs)for(var a in r.inputs=[],o.data.inputs)r.addOutput(o.data.inputs[a][0],o.data.inputs[a][1]);if(o.data.outputs)for(var a in r.outputs=[],o.data.outputs)r.addOutput(o.data.outputs[a][0],o.data.outputs[a][1]);o.data.title&&(r.title=o.data.title),o.data.json&&r.configure(o.data.json)}}n.close()}function g(t){var e=u;u&&u.classList.remove("selected"),u?(u=t?u.nextSibling:u.previousSibling,u||(u=e)):u=t?o.childNodes[0]:o.childNodes[o.childNodes.length],u&&(u.classList.add("selected"),u.scrollIntoView())}function f(){l=null;var t=h.value;if(r=null,o.innerHTML="",t)if(i.onSearchBox){var n=i.onSearchBox(o,t,p);if(n)for(var s=0;s<n.length;++s)f(n[s])}else{var u=0;for(var s in t=t.toLowerCase(),e.searchbox_extras){var c=e.searchbox_extras[s];if(-1!==c.desc.toLowerCase().indexOf(t)&&(f(c.desc,"searchbox_extra"),-1!==a.search_limit&&u++>a.search_limit))break}if(Array.prototype.filter){var d=Object.keys(e.registered_node_types),g=d.filter((function(e){return-1!==e.toLowerCase().indexOf(t)}));for(s=0;s<g.length;s++)if(f(g[s]),-1!==a.search_limit&&u++>a.search_limit)break}else for(var s in e.registered_node_types)if(-1!=s.indexOf(t)&&(f(s),-1!==a.search_limit&&u++>a.search_limit))break}function f(t,e){var i=document.createElement("div");r||(r=t),i.innerText=t,i.dataset["type"]=escape(t),i.className="litegraph lite-search-item",e&&(i.className+=" "+e),i.addEventListener("click",(function(t){_(unescape(this.dataset["type"]))})),o.appendChild(i)}}return d&&(d.left,d.top),n.style.left="100px",n.style.top="100px",c.parentNode.appendChild(n),h.focus(),n},a.prototype.showEditPropertyValue=function(t,e,i){if(t&&void 0!==t.properties[e]){i=i||{};var n="string";null!==t.properties[e]&&(n=typeof t.properties[e]),"object"==n&&t.properties[e].length&&(n="array");var s=null;if(t.getPropertyInfo&&(s=t.getPropertyInfo(e)),t.properties_info)for(var o=0;o<t.properties_info.length;++o)if(t.properties_info[o].name==e){s=t.properties_info[o];break}void 0!==s&&null!==s&&s.type&&(n=s.type);var r="";if("string"==n||"number"==n||"array"==n)r="<input autofocus type='text' class='value'/>";else if("enum"==n&&s.values){for(var o in r="<select autofocus type='text' class='value'>",s.values){var a=s.values.constructor===Array?s.values[o]:o;r+="<option value='"+a+"' "+(a==t.properties[e]?"selected":"")+">"+s.values[o]+"</option>"}r+="</select>"}else{if("boolean"!=n)return void console.warn("unknown type: "+n);r="<input autofocus type='checkbox' class='value' "+(t.properties[e]?"checked":"")+"/>"}var l=this.createDialog("<span class='name'>"+e+"</span>"+r+"<button>OK</button>",i);if("enum"==n&&s.values){var u=l.querySelector("select");u.addEventListener("change",(function(t){c(t.target.value)}))}else if("boolean"==n){u=l.querySelector("input");u&&u.addEventListener("click",(function(t){c(!!u.checked)}))}else{u=l.querySelector("input");u&&(u.addEventListener("blur",(function(t){this.focus()})),u.value=void 0!==t.properties[e]?t.properties[e]:"",u.addEventListener("keydown",(function(t){13==t.keyCode&&(p(),t.preventDefault(),t.stopPropagation())})))}var h=l.querySelector("button");h.addEventListener("click",p)}function p(){c(u.value)}function c(i){"number"==typeof t.properties[e]&&(i=Number(i)),"array"==n&&(i=i.split(",").map(Number)),t.properties[e]=i,t._graph&&t._graph._version++,t.onPropertyChanged&&t.onPropertyChanged(e,i),l.close(),t.setDirtyCanvas(!0,!0)}},a.prototype.createDialog=function(t,e){e=e||{};var i=document.createElement("div");i.className="graphdialog",i.innerHTML=t;var n=this.canvas.getBoundingClientRect();return n&&(n.left,n.top),e.position?(e.position[0],e.position[1]):e.event?(e.event.clientX,e.event.clientY):(.5*this.canvas.width,.5*this.canvas.height),i.style.left="100px",i.style.top="100px",this.canvas.parentNode.appendChild(i),i.close=function(){this.parentNode&&this.parentNode.removeChild(this)},i},a.onMenuNodeCollapse=function(t,e,i,n,s){s.collapse()},a.onMenuNodePin=function(t,e,i,n,s){s.pin()},a.onMenuNodeMode=function(t,i,n,s,o){function r(t){if(o)switch(t){case"On Event":o.mode=e.ON_EVENT;break;case"On Trigger":o.mode=e.ON_TRIGGER;break;case"Never":o.mode=e.NEVER;break;case"Always":default:o.mode=e.ALWAYS;break}}return new e.ContextMenu(["Always","On Event","On Trigger","Never"],{event:n,callback:r,parentMenu:s,node:o}),!1},a.onMenuNodeColors=function(t,i,n,s,o){if(!o)throw"no node for color";var r=[];for(var l in r.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"}),a.node_colors){var u=a.node_colors[l];t={value:l,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+u.color+"; background-color:"+u.bgcolor+"'>"+l+"</span>"};r.push(t)}function h(t){if(o){var i=t.value?a.node_colors[t.value]:null;i?o.constructor===e.LGraphGroup?o.color=i.groupcolor:(o.color=i.color,o.bgcolor=i.bgcolor):(delete o.color,delete o.bgcolor),o.setDirtyCanvas(!0,!0)}}return new e.ContextMenu(r,{event:n,callback:h,parentMenu:s,node:o}),!1},a.onMenuNodeShapes=function(t,i,n,s,o){if(!o)throw"no node passed";function r(t){o&&(o.shape=t,o.setDirtyCanvas(!0))}return new e.ContextMenu(e.VALID_SHAPES,{event:n,callback:r,parentMenu:s,node:o}),!1},a.onMenuNodeRemove=function(t,e,i,n,s){if(!s)throw"no node passed";!1!==s.removable&&(s.graph.remove(s),s.setDirtyCanvas(!0,!0))},a.onMenuNodeClone=function(t,e,i,n,s){if(0!=s.clonable){var o=s.clone();o&&(o.pos=[s.pos[0]+5,s.pos[1]+5],s.graph.add(o),s.setDirtyCanvas(!0,!0))}},a.node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}},a.prototype.getCanvasMenuOptions=function(){var t=null;if(this.getMenuOptions?t=this.getMenuOptions():(t=[{content:"Add Node",has_submenu:!0,callback:a.onMenuAdd},{content:"Add Group",callback:a.onGroupAdd}],this._graph_stack&&this._graph_stack.length>0&&t.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)})),this.getExtraMenuOptions){var e=this.getExtraMenuOptions(this,t);e&&(t=t.concat(e))}return t},a.prototype.getNodeMenuOptions=function(t){var e=null;if(e=t.getMenuOptions?t.getMenuOptions(this):[{content:"Inputs",has_submenu:!0,disabled:!0,callback:a.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:a.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:a.onShowMenuNodeProperties},null,{content:"Title",callback:a.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:a.onMenuNodeMode},{content:"Resize",callback:a.onResizeNode},{content:"Collapse",callback:a.onMenuNodeCollapse},{content:"Pin",callback:a.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:a.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:a.onMenuNodeShapes},null],t.onGetInputs){var i=t.onGetInputs();i&&i.length&&(e[0].disabled=!1)}if(t.onGetOutputs){var n=t.onGetOutputs();n&&n.length&&(e[1].disabled=!1)}if(t.getExtraMenuOptions){var s=t.getExtraMenuOptions(this);s&&(s.push(null),e=s.concat(e))}return!1!==t.clonable&&e.push({content:"Clone",callback:a.onMenuNodeClone}),!1!==t.removable&&e.push(null,{content:"Remove",callback:a.onMenuNodeRemove}),t.graph&&t.graph.onGetNodeMenuOptions&&t.graph.onGetNodeMenuOptions(e,t),e},a.prototype.getGroupMenuOptions=function(t){var e=[{content:"Title",callback:a.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:a.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:a.onShowPropertyEditor},null,{content:"Remove",callback:a.onMenuNodeRemove}];return e},a.prototype.processContextMenu=function(t,i){var n=this,s=a.active_canvas,o=s.getCanvasWindow(),r=null,l={event:i,callback:c,extra:t};t&&(l.title=t.type);var u=null;if(t&&(u=t.getSlotInPosition(i.canvasX,i.canvasY),a.active_node=t),u){r=[],u&&u.output&&u.output.links&&u.output.links.length&&r.push({content:"Disconnect Links",slot:u});var h=u.input||u.output;r.push(h.locked?"Cannot remove":{content:"Remove Slot",slot:u}),r.push(h.nameLocked?"Cannot rename":{content:"Rename Slot",slot:u}),l.title=(u.input?u.input.type:u.output.type)||"*",u.input&&u.input.type==e.ACTION&&(l.title="Action"),u.output&&u.output.type==e.EVENT&&(l.title="Event")}else if(t)r=this.getNodeMenuOptions(t);else{r=this.getCanvasMenuOptions();var p=this.graph.getGroupOnPos(i.canvasX,i.canvasY);p&&r.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:p,options:this.getGroupMenuOptions(p)}})}if(r)new e.ContextMenu(r,l,o);function c(e,i,s){if(e)if("Remove Slot"!=e.content)if("Disconnect Links"!=e.content){if("Rename Slot"==e.content){l=e.slot;var o=l.input?t.getInputInfo(l.slot):t.getOutputInfo(l.slot),r=n.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",i),a=r.querySelector("input");a&&o&&(a.value=o.label||""),r.querySelector("button").addEventListener("click",(function(t){a.value&&(o&&(o.label=a.value),n.setDirty(!0)),r.close()}))}}else{var l=e.slot;l.output?t.disconnectOutput(l.slot):l.input&&t.disconnectInput(l.slot)}else{var l=e.slot;l.input?t.removeInput(l.slot):l.output&&t.removeOutput(l.slot)}}},this.CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.roundRect=function(t,e,i,n,s,o){void 0===s&&(s=5),void 0===o&&(o=s),this.moveTo(t+s,e),this.lineTo(t+i-s,e),this.quadraticCurveTo(t+i,e,t+i,e+s),this.lineTo(t+i,e+n-o),this.quadraticCurveTo(t+i,e+n,t+i-o,e+n),this.lineTo(t+o,e+n),this.quadraticCurveTo(t,e+n,t,e+n-o),this.lineTo(t,e+s),this.quadraticCurveTo(t,e,t+s,e)}),e.compareObjects=g,e.distance=f,e.colorToString=v,e.isInsideRectangle=m,e.growBounding=y,e.isInsideBounding=b,e.overlapBounding=E,e.hex2num=T,e.num2hex=w,O.prototype.addItem=function(t,e,i){var n=this;i=i||{};var s=document.createElement("div");s.className="litemenu-entry submenu";var o=!1;function r(t){var e=this.value;e&&e.has_submenu&&a.call(this,t)}function a(t){var e=this.value,s=!0;if(n.current_submenu&&n.current_submenu.close(t),i.callback){var o=i.callback.call(this,e,i,t,n,i.node);!0===o&&(s=!1)}if(e){if(e.callback&&!i.ignore_item_callbacks&&!0!==e.disabled){o=e.callback.call(this,e,i,t,n,i.extra);!0===o&&(s=!1)}if(e.submenu){if(!e.submenu.options)throw"ContextMenu submenu needs options";new n.constructor(e.submenu.options,{callback:e.submenu.callback,event:t,parentMenu:n,ignore_item_callbacks:e.submenu.ignore_item_callbacks,title:e.submenu.title,extra:e.submenu.extra,autoopen:i.autoopen});s=!1}}s&&!n.lock&&n.close()}return null===e?s.classList.add("separator"):(s.innerHTML=e&&e.title?e.title:t,s.value=e,e&&(e.disabled&&(o=!0,s.classList.add("disabled")),(e.submenu||e.has_submenu)&&s.classList.add("has_submenu")),"function"==typeof e?(s.dataset["value"]=t,s.onclick_callback=e):s.dataset["value"]=e,e.className&&(s.className+=" "+e.className)),this.root.appendChild(s),o||s.addEventListener("click",a),i.autoopen&&s.addEventListener("mouseenter",r),s},O.prototype.close=function(t,e){this.root.parentNode&&this.root.parentNode.removeChild(this.root),this.parentMenu&&!e&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=null,void 0===t?this.parentMenu.close():t&&!O.isCursorOverElement(t,this.parentMenu.root)&&O.trigger(this.parentMenu.root,"mouseleave",t)),this.current_submenu&&this.current_submenu.close(t,!0),this.root.closing_timer&&clearTimeout(this.root.closing_timer)},O.trigger=function(t,e,i,n){var s=document.createEvent("CustomEvent");return s.initCustomEvent(e,!0,!0,i),s.srcElement=n,t.dispatchEvent?t.dispatchEvent(s):t.__events&&t.__events.dispatchEvent(s),s},O.prototype.getTopMenu=function(){return this.options.parentMenu?this.options.parentMenu.getTopMenu():this},O.prototype.getFirstEvent=function(){return this.options.parentMenu?this.options.parentMenu.getFirstEvent():this.options.event},O.isCursorOverElement=function(t,e){var i=t.clientX,n=t.clientY,s=e.getBoundingClientRect();return!!s&&(n>s.top&&n<s.top+s.height&&i>s.left&&i<s.left+s.width)},e.ContextMenu=O,e.closeAllContextMenus=function(t){t=t||window;var e=t.document.querySelectorAll(".litecontextmenu");if(e.length){for(var i=[],n=0;n<e.length;n++)i.push(e[n]);for(var n in i)i[n].close?i[n].close():i[n].parentNode&&i[n].parentNode.removeChild(i[n])}},e.extendClass=function(t,e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i]);if(e.prototype)for(var i in e.prototype)e.prototype.hasOwnProperty(i)&&(t.prototype.hasOwnProperty(i)||(e.prototype.__lookupGetter__(i)?t.prototype.__defineGetter__(i,e.prototype.__lookupGetter__(i)):t.prototype[i]=e.prototype[i],e.prototype.__lookupSetter__(i)&&t.prototype.__defineSetter__(i,e.prototype.__lookupSetter__(i))))},e.getParameterNames=function(t){return(t+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)},Math.clamp=function(t,e,i){return e>t?e:i<t?i:t},"undefined"==typeof window||window["requestAnimationFrame"]||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}),C.title="Subgraph",C.desc="Graph inside a node",C.title_color="#334",C.prototype.onGetInputs=function(){return[["enabled","boolean"]]},C.prototype.onDrawTitle=function(t){if(!this.flags.collapsed){t.fillStyle="#555";var i=e.NODE_TITLE_HEIGHT,n=this.size[0]-i;t.fillRect(n,-i,i,i),t.fillStyle="#333",t.beginPath(),t.moveTo(n+.2*i,.6*-i),t.lineTo(n+.8*i,.6*-i),t.lineTo(n+.5*i,.3*-i),t.fill()}},C.prototype.onDblClick=function(t,e,i){var n=this;setTimeout((function(){i.openSubgraph(n.subgraph)}),10)},C.prototype.onMouseDown=function(t,i,n){if(!this.flags.collapsed&&i[0]>this.size[0]-e.NODE_TITLE_HEIGHT&&i[1]<0){var s=this;setTimeout((function(){n.openSubgraph(s.subgraph)}),10)}},C.prototype.onAction=function(t,e){this.subgraph.onAction(t,e)},C.prototype.onExecute=function(){if(this.enabled=this.getInputOrProperty("enabled"),this.enabled){if(this.inputs)for(var t=0;t<this.inputs.length;t++){var e=this.inputs[t],i=this.getInputData(t);this.subgraph.setInputData(e.name,i)}if(this.subgraph.runStep(),this.outputs)for(t=0;t<this.outputs.length;t++){var n=this.outputs[t];i=this.subgraph.getOutputData(n.name);this.setOutputData(t,i)}}},C.prototype.sendEventToAllNodes=function(t,e,i){this.enabled&&this.subgraph.sendEventToAllNodes(t,e,i)},C.prototype.onSubgraphTrigger=function(t,e){var i=this.findOutputSlot(t);-1!=i&&this.triggerSlot(i)},C.prototype.onSubgraphNewInput=function(t,e){var i=this.findInputSlot(t);-1==i&&this.addInput(t,e)},C.prototype.onSubgraphRenamedInput=function(t,e){var i=this.findInputSlot(t);if(-1!=i){var n=this.getInputInfo(i);n.name=e}},C.prototype.onSubgraphTypeChangeInput=function(t,e){var i=this.findInputSlot(t);if(-1!=i){var n=this.getInputInfo(i);n.type=e}},C.prototype.onSubgraphRemovedInput=function(t){var e=this.findInputSlot(t);-1!=e&&this.removeInput(e)},C.prototype.onSubgraphNewOutput=function(t,e){var i=this.findOutputSlot(t);-1==i&&this.addOutput(t,e)},C.prototype.onSubgraphRenamedOutput=function(t,e){var i=this.findOutputSlot(t);if(-1!=i){var n=this.getOutputInfo(i);n.name=e}},C.prototype.onSubgraphTypeChangeOutput=function(t,e){var i=this.findOutputSlot(t);if(-1!=i){var n=this.getOutputInfo(i);n.type=e}},C.prototype.onSubgraphRemovedOutput=function(t){var e=this.findInputSlot(t);-1!=e&&this.removeOutput(e)},C.prototype.getExtraMenuOptions=function(t){var e=this;return[{content:"Open",callback:function(){t.openSubgraph(e.subgraph)}}]},C.prototype.onResize=function(t){t[1]+=20},C.prototype.serialize=function(){var t=s.prototype.serialize.call(this);return t.subgraph=this.subgraph.serialize(),t},C.prototype.clone=function(){var t=e.createNode(this.type),i=this.serialize();return delete i["id"],delete i["inputs"],delete i["outputs"],t.configure(i),t},e.Subgraph=C,e.registerNodeType("graph/subgraph",C),D.title="Input",D.desc="Input of the graph",D.prototype.onConfigure=function(){this.updateType()},D.prototype.updateType=function(){var t=this.properties.type;this.type_widget.value=t,"number"==t?(this.value_widget.type="number",this.value_widget.value=0):"bool"==t?(this.value_widget.type="toggle",this.value_widget.value=!0):"string"==t?(this.value_widget.type="text",this.value_widget.value=""):(this.value_widget.type=null,this.value_widget.value=null),this.properties.value=this.value_widget.value},D.prototype.onPropertyChanged=function(t,e){if("name"==t){if(""==e||e==this.name_in_graph||"enabled"==e)return!1;this.graph&&(this.name_in_graph?this.graph.renameInput(this.name_in_graph,e):this.graph.addInput(e,this.properties.type)),this.name_widget.value=e,this.name_in_graph=e}else"type"==t&&(e=e||"",this.updateType(e))},D.prototype.getTitle=function(){return this.flags.collapsed?this.properties.name:this.title},D.prototype.onAction=function(t,i){this.properties.type==e.EVENT&&this.triggerSlot(0,i)},D.prototype.onExecute=function(){var t=this.properties.name,e=this.graph.inputs[t];e||this.setOutputData(0,this.properties.value),this.setOutputData(0,void 0===e.value?this.properties.value:e.value)},D.prototype.onRemoved=function(){this.name_in_graph&&this.graph.removeInput(this.name_in_graph)},e.GraphInput=D,e.registerNodeType("graph/input",D),k.title="Output",k.desc="Output of the graph",k.prototype.onExecute=function(){this._value=this.getInputData(0),this.graph.setOutputData(this.properties.name,this._value)},k.prototype.onAction=function(t,i){this.properties.type==e.ACTION&&this.graph.trigger(this.properties.name,i)},k.prototype.onRemoved=function(){this.name_in_graph&&this.graph.removeOutput(this.name_in_graph)},k.prototype.getTitle=function(){return this.flags.collapsed?this.properties.name:this.title},e.GraphOutput=k,e.registerNodeType("graph/output",k)})(this),exports.LiteGraph=this.LiteGraph,function(t){var e=t.LiteGraph;function i(){this.addOutput("in ms","number"),this.addOutput("in sec","number")}function n(){this.addOutput("input",""),this.addOutput("uri",""),this.addOutput("collections",""),this.name_in_graph="",this.properties={};this.widgets_up=!0,this.size=[180,60]}function s(){this.addInput("output",null),this.addInput("headers",null),this.addInput("triples",null),this.addInput("instance",null),this.addInput("attachments",null),this.addInput("uri",null),this.addInput("collections",null),this.addOutput("output",null),this.name_in_graph="",this.properties={};this.size=[180,160]}function o(){this.addInput("output",null),this.addInput("headers",null),this.addInput("triples",null),this.addInput("instance",null),this.addInput("attachments",null),this.addInput("uri",null),this.addInput("collections",null),this.name_in_graph="",this.properties={};this.size=[180,160]}function r(){this.addOutput("value","number"),this.addProperty("value",1),this.editable={property:"value",type:"number"}}function a(){this.size=[60,20],this.addInput("value",0,{label:""}),this.value=0}function l(){this.addInput("in",0),this.addOutput("out",0),this.size=[40,20]}function u(){this.mode=e.ON_EVENT,this.size=[60,20],this.addProperty("msg",""),this.addInput("log",e.EVENT),this.addInput("msg",0)}function h(){this.size=[60,20],this.addProperty("onExecute",""),this.addInput("in",""),this.addInput("in2",""),this.addOutput("out",""),this.addOutput("out2",""),this._func=null}i.title="Time",i.desc="Time",i.prototype.onExecute=function(){this.setOutputData(0,1e3*this.graph.globaltime),this.setOutputData(1,this.graph.globaltime)},e.registerNodeType("basic/time",i),n.title="Input",n.desc="Input of the graph",n.prototype.getTitle=function(){return this.flags.collapsed?this.properties.name:this.title},n.prototype.onAction=function(t,i){this.properties.type==e.EVENT&&this.triggerSlot(0,i)},n.prototype.onExecute=function(){var t=this.graph.inputs["input"],e=this.graph.inputs["uri"],i=this.graph.inputs["collections"];this.setOutputData(0,t.value),this.setOutputData(1,e.value),this.setOutputData(2,i.value)},n.prototype.onRemoved=function(){this.name_in_graph&&this.graph.removeInput(this.name_in_graph)},e.GraphInput=n,e.registerNodeType("dhf/input",n),s.title="Output Object",s.desc="DHF output object",s.prototype.onExecute=function(){let t={envelope:{}};if(void 0==this.getInputData(0)){t.envelope.headers=void 0!=this.getInputData(1)?this.getInputData(1):{},t.envelope.triples=void 0!=this.getInputData(2)?this.getInputData(2):{},t.envelope.instance=void 0!=this.getInputData(3)?this.getInputData(3):{},t.envelope.attachments=void 0!=this.getInputData(4)?this.getInputData(4):{};let e=null!=this.graph.inputs["collections"]?this.graph.inputs["collections"].value:null,i=null!=this.graph.inputs["urei"]?this.graph.inputs["uri"].value:sem.uuidString(),n=null!=this.graph.inputs["context"]?this.graph.inputs["context"].value:{},s=void 0!=this.getInputData(5)?this.getInputData(5):i,o=void 0!=this.getInputData(6)?this.getInputData(6):e,r=n,a={};a.value=t,a.uri=s,r.collections=o,a.context=r,this.setOutputData(0,a)}else this.setOutputData(0,this.getInputData(0))},s.prototype.onAction=function(t,i){this.properties.type==e.ACTION&&this.graph.trigger(this.properties.name,i)},s.prototype.onRemoved=function(){this.name_in_graph&&this.graph.removeOutput(this.name_in_graph)},s.prototype.getTitle=function(){return this.flags.collapsed?this.properties.name:this.title},e.registerNodeType("dhf/outputObject",s),o.title="Output",o.desc="Output of the graph",o.prototype.onExecute=function(){let t={envelope:{}};if(void 0==this.getInputData(0)){t.envelope.headers=void 0!=this.getInputData(1)?this.getInputData(1):{},t.envelope.triples=void 0!=this.getInputData(2)?this.getInputData(2):{},t.envelope.instance=void 0!=this.getInputData(3)?this.getInputData(3):{},t.envelope.attachments=void 0!=this.getInputData(4)?this.getInputData(4):{};let e=void 0!=this.getInputData(5)?this.getInputData(5):this.graph.inputs["uri"].value,i=void 0!=this.getInputData(6)?this.getInputData(6):this.graph.inputs["collections"].value,n=this.graph.inputs["context"].value,s={};s.value=t,s.uri=e,n.collections=i,s.context=n,this.graph.setOutputData("output",s)}else this.graph.setOutputData("output",this.getInputData(0))},o.prototype.onAction=function(t,i){this.properties.type==e.ACTION&&this.graph.trigger(this.properties.name,i)},o.prototype.onRemoved=function(){this.name_in_graph&&this.graph.removeOutput(this.name_in_graph)},o.prototype.getTitle=function(){return this.flags.collapsed?this.properties.name:this.title},e.GraphOutput=o,e.registerNodeType("dhf/output",o),r.title="Const",r.desc="Constant value",r.prototype.setValue=function(t){"string"==typeof t&&(t=parseFloat(t)),this.properties["value"]=t,this.setDirtyCanvas(!0)},r.prototype.onExecute=function(){this.setOutputData(0,parseFloat(this.properties["value"]))},r.prototype.onDrawBackground=function(t){this.outputs[0].label=this.properties["value"].toFixed(3)},e.registerNodeType("basic/const",r),a.title="Watch",a.desc="Show value of input",a.prototype.onExecute=function(){this.inputs[0]&&(this.value=this.getInputData(0))},a.toString=function(t){if(null==t)return"null";if(t.constructor===Number)return t.toFixed(3);if(t.constructor===Array){for(var e="[",i=0;i<t.length;++i)e+=a.toString(t[i])+(i+1!=t.length?",":"");return e+="]",e}return String(t)},a.prototype.onDrawBackground=function(t){this.inputs[0].label=a.toString(this.value)},e.registerNodeType("basic/watch",a),l.title="Pass",l.desc="Allows to connect different types",l.prototype.onExecute=function(){this.setOutputData(0,this.getInputData(0))},e.registerNodeType("basic/pass",l),u.title="Console",u.desc="Show value inside the console",u.prototype.onAction=function(t,e){"log"==t?console.log(e):"warn"==t?console.warn(e):"error"==t&&console.error(e)},u.prototype.onExecute=function(){var t=this.getInputData(1);null!==t&&(this.properties.msg=t),console.log(t)},u.prototype.onGetInputs=function(){return[["log",e.ACTION],["warn",e.ACTION],["error",e.ACTION]]},e.registerNodeType("basic/console",u),h.title="Script",h.desc="executes a code",h.widgets_info={onExecute:{type:"code"}},h.prototype.onPropertyChanged=function(t,i){if("onExecute"==t&&e.allow_scripts){this._func=null;try{this._func=new Function(i)}catch(n){console.error("Error parsing script"),console.error(n)}}},h.prototype.onExecute=function(){if(this._func)try{this._func.call(this)}catch(t){console.error("Error in script"),console.error(t)}},e.registerNodeType("basic/script",h)}(this),function(global){var LiteGraph=global.LiteGraph;function StringConstant(){this.addOutput("value","xs:string"),this.string=this.addWidget("text","string","Your string",(function(t){}),{}),this.size=[180,60],this.serialize_widgets=!0}function currentDate(){this.size=[300,300],this.addOutput("current"),this.addProperty("currentDate","currentDate","enum",{values:currentDate.values})}function docByKey(){this.addInput("id"),this.addOutput("doc","node"),this.addProperty("Template","cts.andQuery([cts.collectionQuery('/otherCollection'),cts.jsonPropertyValueQuery('theKey',${id})])")}function stringTemplate(){this.addInput("v1"),this.addInput("v2"),this.addInput("v3"),this.addOutput("newString","xs:string"),this.v5=this.addWidget("text","v4","v4",(function(t){}),{}),this.v6=this.addWidget("text","v5","v5",(function(t){}),{}),this.template=this.addWidget("text","template","${v1} ${v2} ${v3} ${v4}",(function(t){}),{}),this.size=[230,160],this.serialize_widgets=!0}function multicast(){this.addInput("v1"),this.addInput("v2"),this.addInput("v3"),this.addInput("v4"),this.addOutput("v1"),this.addOutput("v2"),this.addOutput("v3"),this.addOutput("v4"),this.type1=this.addWidget("combo","type1","string",(function(t){}),{values:["string","int","float"]}),this.type2=this.addWidget("combo","type2","string",(function(t){}),{values:["string","int","float"]}),this.type3=this.addWidget("combo","type3","string",(function(t){}),{values:["string","int","float"]}),this.type4=this.addWidget("combo","type4","string",(function(t){}),{values:["string","int","float"]}),this.size=[230,180],this.serialize_widgets=!0}function hashNode(){this.addInput("Node",null),this.addOutput("Hash","xs:string"),this.properties={};this.hashAlgo=this.addWidget("combo","hash function","hash64",(function(t){}),{values:["hash64","sha1","sha256","sha512"]}),this.size=this.computeSize(),this.serialize_widgets=!0}function TestWidgetsNode(){this.addInput("clientId",null),this.addOutput("result","number"),this.properties={};this.slider=this.addWidget("slider","Last # days",365,(function(t){}),{min:0,max:1e3}),this.combo=this.addWidget("combo","Operation","sum",(function(t){}),{values:["sum","avg","min","max","count"]}),this.combo=this.addWidget("combo","Data","Amount",(function(t){}),{values:["TransactionDate","Amount","Discount"]}),this.size=this.computeSize(),this.serialize_widgets=!0}function selectCase(){this.addInput("value2Test",null),this.addProperty("testCasesStr",""),this.addProperty("testCases",""),this.addOutput("result",null);this.slider=this.addWidget("text","nbInputs",1,function(t){for(let e=0;e<this.inputs.length;e++)this.removeInput("input"+e,null);this.addInput("value2Test",null);for(let e=0;e<parseInt(t);e++)this.addInput("input"+e,null)}.bind(this),{min:0,max:1e3}),this.size=this.computeSize(),this.serialize_widgets=!0}StringConstant.title="Constant",StringConstant.desc="Constant value",StringConstant.prototype.onExecute=function(){this.setOutputData(0,this.string.value)},LiteGraph.registerNodeType("string/constant",StringConstant),currentDate.values=["currentDate","currentDateTime","currentTime"],currentDate.title="Current date(time)",currentDate.desc="Outputs current date(time)",currentDate["currentDate"]={type:"enum",title:"currentDate",values:currentDate.values},currentDate.prototype.getTitle=function(){return this.properties.currentDate},currentDate.prototype.setValue=function(t){this.properties["value"]=t},currentDate.prototype.onExecute=function(){switch(this.properties.currentDate){case"currentDate":this.setOutputData(0,fn.currentDate());break;case"currentDateTime":this.setOutputData(0,fn.currentDateTime());break;case"currentTime":this.setOutputData(0,fn.currentTime());break}},currentDate.prototype.onDrawBackground=function(t){this.flags.collapsed},LiteGraph.registerNodeType("date/Current Date",currentDate),docByKey.title="Get Doc by ID",docByKey.desc="Get other doc by ID",docByKey.prototype.onExecute=function(){let id=this.getInputData(0),template="`"+this.properties.Template+"`",queryStr=eval(template),query=eval(queryStr),result=fn.head(cts.search(query));this.setOutputData(0,result)},LiteGraph.registerNodeType("feature/Doc By Key",docByKey),stringTemplate.title="String Templating",stringTemplate.desc="Apply string template on inputs",stringTemplate.prototype.onExecute=function(){let v1=this.getInputData(0),v2=this.getInputData(1),v3=this.getInputData(2),v4=this.v4.value,v5=this.v5.value,template="`"+this.template.value+"`",result=eval(template);this.setOutputData(0,result)},LiteGraph.registerNodeType("string/Templating",stringTemplate),multicast.title="Multicast",multicast.desc="Cast input to type",multicast.prototype.onExecute=function(){for(let t=0;t<5;t++)if(void 0!=this.getInputData(t))switch(this["type"+t].value){case"string":this.setOutputData(t,String(this.getInputData(t)));break;case"int":this.setOutputData(t,parseInt(this.getInputData(t)));break;case"float":this.setOutputData(t,parseFloat(this.getInputData(t)));break;case"date":this.setOutputData(t,new date(this.getInputData(t)));break;default:this.setOutputData(t,this.getInputData(t))}},LiteGraph.registerNodeType("basic/multicast",multicast),TestWidgetsNode.title="Hash Node content",LiteGraph.registerNodeType("feature/hashNode",hashNode),TestWidgetsNode.title="Transaction stats*",LiteGraph.registerNodeType("feature/widgets",TestWidgetsNode),selectCase.title="Select case",LiteGraph.registerNodeType("feature/selectCase",selectCase)}(this)}).call(this,__webpack_require__("4362"))},"8b24":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("q-page",{staticClass:"flex fixed-center"},[i("mllitegraph"),i("q-dialog",{model:{value:t.startup,callback:function(e){t.startup=e},expression:"startup"}},[i("q-card",[i("q-toolbar",[i("q-avatar",[i("img",{attrs:{src:"https://cdn.quasar.dev/logo/svg/quasar-logo.svg"}})]),i("q-toolbar-title",[i("span",{staticClass:"text-weight-bold"},[t._v("Disclaimer")]),t._v(" Visual Programming Plugin")]),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",round:"",dense:"",icon:"close"}})],1),i("q-card-section",[t._v("\n          Visual Programming Plugin (VPP) for MarkLogic DataHub is a community tool."),i("br"),t._v("\n          As such, "),i("b",[t._v("VPP is not supported by MarkLogic Corporation")]),t._v(" and is only updated and corrected based on best effort approach.\n          Any contribution or feedback is welcomed to make the tool better."),i("br"),i("b",[t._v("VPP Team")]),i("br"),i("br"),t._v("\n          Version 0.8 / What's new :\n          "),i("ul",[i("li",[t._v("New highlight block on string")]),i("li",[t._v("New entity enrichment block on string")]),i("li",[t._v("New XML and Json schema validation block")])])])],1)],1)],1)},s=[],o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"flex flex-center"},[i("canvas",{ref:"mycanvas",staticClass:"fixed",staticStyle:{border:"1px solid"},attrs:{height:"1000",width:"1800"}}),i("q-dialog",{attrs:{persistent:""},model:{value:t.editQuery,callback:function(e){t.editQuery=e},expression:"editQuery"}},[i("q-card",[i("q-card-section",[i("div",{staticClass:"text-h6"},[t._v("Edit Query")])]),i("q-card-section",[i("div",{staticClass:"q-pa-md",staticStyle:{"max-width":"600px","min-width":"500px"}},[i("q-input",{attrs:{filled:"",type:"textarea"},model:{value:t.currentCtsQuery.ctsQuery,callback:function(e){t.$set(t.currentCtsQuery,"ctsQuery",e)},expression:"currentCtsQuery.ctsQuery"}})],1)]),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{color:"primary",flat:"",label:"OK"}})],1)],1)],1),i("q-dialog",{attrs:{persistent:""},model:{value:t.editCases,callback:function(e){t.editCases=e},expression:"editCases"}},[i("q-card",[i("q-card-section",[i("div",{staticClass:"text-h6"},[t._v("Edit Cases")])]),i("q-card-section",[i("div",{staticClass:"q-pa-md",staticStyle:{"max-width":"600px","min-width":"500px"}},[i("q-input",{attrs:{filled:"",type:"textarea"},model:{value:t.currentCases,callback:function(e){t.currentCases=e},expression:"currentCases"}})],1)]),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{color:"primary",flat:"",label:"OK"}})],1)],1)],1),i("q-dialog",{attrs:{persistent:""},model:{value:t.editJson,callback:function(e){t.editJson=e},expression:"editJson"}},[i("q-card",[i("q-card-section",[i("div",{staticClass:"text-h6"},[t._v("Edit data mapping")])]),i("q-card-section",[i("q-table",{attrs:{columns:t.columns,data:t.currentProperties,"binary-state-sort":"","row-key":"name",title:"Mappings"},scopedSlots:t._u([{key:"body",fn:function(e){return[i("q-tr",{attrs:{props:e}},[i("q-td",{key:"source",attrs:{props:e}},[t._v("\n                "+t._s(e.row.source)+"\n                "),i("q-popup-edit",{attrs:{buttons:"",title:"Update mapping"},model:{value:e.row.source,callback:function(i){t.$set(e.row,"source",i)},expression:"props.row.source"}},[i("q-input",{attrs:{autofocus:"",dense:"",type:"string"},model:{value:e.row.source,callback:function(i){t.$set(e.row,"source",i)},expression:"props.row.source"}})],1)],1),i("q-td",{key:"target",attrs:{props:e}},[t._v("\n                "+t._s(e.row.target)+"\n                "),i("q-popup-edit",{attrs:{buttons:"",title:"Update mapping"},model:{value:e.row.target,callback:function(i){t.$set(e.row,"target",i)},expression:"props.row.target"}},[i("q-input",{attrs:{autofocus:"",dense:"",type:"string"},model:{value:e.row.target,callback:function(i){t.$set(e.row,"target",i)},expression:"props.row.target"}})],1)],1)],1)]}}])})],1),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{attrs:{color:"primary",flat:"",label:"Add mapping"},on:{click:function(e){return t.addMapping()}}}),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{color:"primary",flat:"",label:"OK"}})],1)],1)],1),i("q-dialog",{attrs:{"content-css":{minWidth:"30vw",minHeight:"40vh"}},model:{value:t.savePopUpOpened,callback:function(e){t.savePopUpOpened=e},expression:"savePopUpOpened"}},[i("q-layout",{staticClass:"bg-white",attrs:{container:""}},[i("div",{staticClass:"layout-padding"},[i("q-item-label",{attrs:{header:!0}},[t._v("Save current graph")]),i("div",[i("q-input",{attrs:{"stack-label":"true",label:"Graph name"},model:{value:t.graphName,callback:function(e){t.graphName=e},expression:"graphName"}})],1),i("div",{staticClass:"q-pa-sm"},[i("q-btn",{attrs:{color:"primary",label:"Save"},on:{click:function(e){return t.saveCurrentGraph()}}}),i("q-btn",{attrs:{color:"primary",label:"Close"},on:{click:function(e){t.savePopUpOpened=!1}}})],1)],1)])],1),i("q-dialog",{attrs:{"content-css":{minWidth:"30vw",minHeight:"40vh"}},model:{value:t.loadPopUpOpened,callback:function(e){t.loadPopUpOpened=e},expression:"loadPopUpOpened"}},[i("q-layout",{staticClass:"bg-white",attrs:{container:""}},[i("div",{staticClass:"layout-padding"},[i("q-list",{staticClass:"q-mt-md",attrs:{link:""}},[i("q-item-label",{attrs:{header:!0}},[t._v("List of saved graph")]),t._l(t.savedGraph,(function(e,n){return i("q-item",{key:e.name,attrs:{tag:"label"},nativeOn:{click:function(i){return t.getSavedGraph(e.uri)}}},[i("q-item-label",[i("q-item-section",{attrs:{label:""}},[t._v(t._s(e.name))])],1)],1)}))],2),i("div",{staticClass:"q-pa-sm"},[i("q-btn",{attrs:{color:"primary",label:"Close"},on:{click:function(e){t.loadPopUpOpened=!1}}})],1)],1)])],1),i("q-dialog",{model:{value:t.showPreview,callback:function(e){t.showPreview=e},expression:"showPreview"}},[i("q-card",[i("q-card-section",{staticClass:"row items-center"},[i("div",{staticClass:"text-h6"},[t._v("Preview")])]),i("q-card-section",{staticClass:"row"},[i("div",{staticStyle:{"min-width":"250px","max-width":"300px"}},[i("q-select",{attrs:{options:t.availableDB,filled:"",label:"Use Database for input"},on:{input:function(e){return t.dbChanged()}},scopedSlots:t._u([{key:"prepend",fn:function(){return[i("q-icon",{attrs:{name:"fas fa-database"},on:{click:function(t){t.stopPropagation()}}})]},proxy:!0}]),model:{value:t.selectedDB,callback:function(e){t.selectedDB=e},expression:"selectedDB"}}),i("q-select",{attrs:{options:t.availableCollections,filled:"",label:"Use collection as input"},scopedSlots:t._u([{key:"prepend",fn:function(){return[i("q-icon",{attrs:{name:"fas fa-tags"},on:{click:function(t){t.stopPropagation()}}})]},proxy:!0}]),model:{value:t.collectionForPreview,callback:function(e){t.collectionForPreview=e},expression:"collectionForPreview"}}),t.saveToDB?i("q-select",{attrs:{options:t.availableDB,filled:"",label:"Save to Database"},scopedSlots:t._u([{key:"prepend",fn:function(){return[i("q-icon",{attrs:{name:"fas fa-database"},on:{click:function(t){t.stopPropagation()}}})]},proxy:!0}],null,!1,618044317),model:{value:t.selectedTargetDB,callback:function(e){t.selectedTargetDB=e},expression:"selectedTargetDB"}}):t._e(),t.randomDocPreview?t._e():i("q-input",{attrs:{label:"Optional doc URI"},model:{value:t.docUri,callback:function(e){t.docUri=e},expression:"docUri"}})],1),i("q-toggle",{attrs:{label:"Random doc"},model:{value:t.randomDocPreview,callback:function(e){t.randomDocPreview=e},expression:"randomDocPreview"}}),i("q-toggle",{attrs:{label:"Save to DB"},model:{value:t.saveToDB,callback:function(e){t.saveToDB=e},expression:"saveToDB"}}),i("div",{staticClass:"q-pa-md q-gutter-sm"},[i("q-btn",{attrs:{color:"primary",label:"Execute Preview"},on:{click:function(e){return t.executeGraph()}}})],1)],1),i("q-card-section",[i("q-scroll-area",{staticStyle:{height:"500px","max-width":"500px"}},[i("div",{staticClass:"q-py-xs"},[i("vue-json-pretty",{attrs:{data:t.jsonFromPreview}})],1)])],1)],1)],1),i("q-dialog",{model:{value:t.isExported,callback:function(e){t.isExported=e},expression:"isExported"}},[i("q-card",[i("q-card-section",[i("div",{staticClass:"text-h6"},[t._v("Information")])]),i("q-card-section",[t._v("\n       The code of you Data Hub Custom step is now available in your browser downloads folder (main.sjs file).\n      ")]),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"OK",color:"primary"}})],1)],1)],1)],1)},r=[],a=i("ea1d"),l=a["a"],u=i("2877"),h=Object(u["a"])(l,o,r,!1,null,null,null),p=h.exports,c=i("d538"),d=i.n(c),_={data:function(){return{startup:!0}},components:{mllitegraph:p,"vue-json-pretty":d.a}},g=_,f=Object(u["a"])(g,n,s,!1,null,null,null);e["default"]=f.exports},ac4d:function(t,e,i){i("3a72")("asyncIterator")},ea1d:function(module,__webpack_exports__,__webpack_require__){"use strict";var _Users_epoilvet_dev_projects_visual_programming_plugin_node_modules_babel_runtime_corejs2_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("c47a"),_Users_epoilvet_dev_projects_visual_programming_plugin_node_modules_babel_runtime_corejs2_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_Users_epoilvet_dev_projects_visual_programming_plugin_node_modules_babel_runtime_corejs2_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("7f7f"),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es6_object_assign__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("f751"),core_js_modules_es6_object_assign__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es6_object_assign__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es6_array_iterator__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("cadf"),core_js_modules_es6_array_iterator__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es6_array_iterator__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("06db"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es6_object_keys__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("456d"),core_js_modules_es6_object_keys__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es6_object_keys__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("28a5"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("ac4d"),core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_7__),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("8a81"),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_8__),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("ac6a"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_9__),litegraph_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("6e14"),litegraph_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(litegraph_js__WEBPACK_IMPORTED_MODULE_10__),file_saver__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("21a6"),file_saver__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(file_saver__WEBPACK_IMPORTED_MODULE_11__),vue_json_pretty__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("d538"),vue_json_pretty__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(vue_json_pretty__WEBPACK_IMPORTED_MODULE_12__),_methods;__webpack_exports__["a"]=_Users_epoilvet_dev_projects_visual_programming_plugin_node_modules_babel_runtime_corejs2_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()({components:{VueJsonPretty:vue_json_pretty__WEBPACK_IMPORTED_MODULE_12___default.a},name:"PageIndex",data:function(){return{currentCtsQuery:"",currentCases:"",selectedTargetDB:null,editQuery:!1,editJson:!1,editCases:!1,saveToDB:!1,graphMetadata:{title:"",version:"00.01",author:"",description:""},columns:[{name:"source",align:"left",label:"Source",field:"source",sortable:!0},{name:"target",label:"Target",field:"target",sortable:!0,align:"left"}],opened:!0,isExported:!1,graph:null,results:null,models:[],showPreview:!1,collectionForPreview:"",jsonFromPreview:{},randomDocPreview:!1,jsonSource:{test:"test"},savePopUpOpened:!1,loadPopUpOpened:!1,graphName:"",savedGraph:[],currentProperties:[],jsoneditor:null,availableCollections:[],selectedDB:null,availableDB:[],docUri:null}},methods:(_methods={registerModel:function(t){console.log("register model"),this.createBlock(t),this.models.push(t)},createBlock:function(t){console.log(t);var e=this.createGraphNodeFromModel(t);litegraph_js__WEBPACK_IMPORTED_MODULE_10__["LiteGraph"].registerNodeType(t.source+"/"+t.collection,e),this.models.push(t),this.$q.notify({color:"positive",position:"top",message:"The new block is now available in the library (right click)",icon:"code"})},addMapping:function(){this.currentProperties.push({source:"val",target:"newVal"})},loadGraphFromJson:function(t){var e=!0,i=!1,n=void 0;try{for(var s,o=t.models[Symbol.iterator]();!(e=(s=o.next()).done);e=!0){var r=s.value,a=this.createGraphNodeFromModel(r);litegraph_js__WEBPACK_IMPORTED_MODULE_10__["LiteGraph"].registerNodeType(r.source+"/"+r.collection,a)}}catch(l){i=!0,n=l}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}this.models=t.models,this.graph.configure(t.executionGraph),t.metadata&&null!=t.metadata.title?this.graphMetadata.title=t.metadata.title:this.graphMetadata.title="",t.metadata&&null!=t.metadata.author?this.graphMetadata.author=t.metadata.author:this.graphMetadata.author="",t.metadata&&null!=t.metadata.version?this.graphMetadata.version=t.metadata.version:this.graphMetadata.version="",t.metadata&&null!=t.metadata.description?this.graphMetadata.description=t.description:this.graphMetadata.description="",this.$root.$emit("initGraphMetadata",this.graphMetadata)},getSavedGraph:function(t){var e=this;this.$axios.post("/v1/resources/vppBackendServices?rs:action=GetSavedGraph&rs:uri="+encodeURI(t)).then((function(t){var i=t.data;e.loadGraphFromJson(i)})).catch((function(){e.$q.notify({color:"negative",position:"top",message:"Loading failed",icon:"report_problem"})}))},loadSavedGraph:function(){var t=this;this.$axios.post("/v1/resources/vppBackendServices?rs:action=ListSavedGraph").then((function(e){t.savedGraph=e.data})).catch((function(){t.$q.notify({color:"negative",position:"top",message:"Loading failed",icon:"report_problem"})}))},dbChanged:function(){this.discoverCollections()},discoverCollections:function(){var t=this,e="";null!=this.selectedDB&&""!=this.selectedDB&&(e+="&rs:database="+this.selectedDB.value,this.$axios.get("/v1/resources/vppBackendServices?rs:action=collectionDetails"+e).then((function(e){t.availableCollections=e.data})).catch((function(){t.$q.notify({color:"negative",position:"top",message:"Loading failed",icon:"report_problem"})})))},csvJSON:function(t){var e=t.split("\n"),i=[],n=e[0].split(";");n=n.map((function(t){return t.trim()}));for(var s=1;s<e.length;s++){var o={},r=e[s].split(";");if(r.length==n.length)for(var a=0;a<n.length;a++)o[n[a]]=r[a].trim();i.push(o)}return i},createGraphFromMapping:function(t){var e=this,i=this.csvJSON(t),n={},s=!0,o=!1,r=void 0;try{for(var a,l=i[Symbol.iterator]();!(s=(a=l.next()).done);s=!0){var u=a.value;null!=u.source&&null==n[u.source]&&(n[u.source]={label:u.source,collection:u.source,source:"Sources",fields:[],options:["fieldsOutputs","nodeInput"]}),null!=u.target&&null==n[u.target]&&(n[u.target]={label:u.target,collection:u.target,source:"Entities",fields:[],options:["fieldsInputs","nodeOutput"]}),null!=u.sourceField&&""!=u.sourceField&&n[u.source].fields.push({label:u.sourceField,field:u.sourceField,path:"//text('"+u.sourceField+"')"}),null!=u.targetField&&""!=u.targetField&&n[u.target].fields.push({label:u.targetField,field:u.targetField,path:"//text('"+u.targetField+"')"})}}catch(m){o=!0,r=m}finally{try{s||null==l.return||l.return()}finally{if(o)throw r}}var h=0,p={};Object.keys(n).map((function(t){e.createBlock(n[t]);var i=litegraph_js__WEBPACK_IMPORTED_MODULE_10__["LiteGraph"].createNode(n[t].source+"/"+n[t].collection);i.pos=[400+200*h++,200+200*h++],e.graph.add(i),p[t]=i}));var c=!0,d=!1,_=void 0;try{for(var g,f=i[Symbol.iterator]();!(c=(g=f.next()).done);c=!0){var v=g.value;null!=v.source&&null!=v.target&&null!=v.sourceField&&null!=v.targetField&&""!=v.source&&""!=v.target&&""!=v.sourceField&&""!=v.targetField&&p[v.source].connect(p[v.source].ioSetup.outputs["//text('"+v.sourceField+"')"],p[v.target].id,p[v.target].ioSetup.inputs["//text('"+v.targetField+"')"])}}catch(m){d=!0,_=m}finally{try{c||null==f.return||f.return()}finally{if(d)throw _}}},createGraphNodeFromModel:function(t){var e=function(){if(this.blockDef=Object.assign({},t,{}),this.doc={input:null,output:null},this.ioSetup={inputs:{_count:0},outputs:{_count:0}},this.blockDef.options.indexOf("getByUri")>-1&&(this.ioSetup.inputs["Uri"]=this.ioSetup.inputs._count++,this.addInput("Uri")),this.blockDef.options.indexOf("nodeInput")>-1&&(this.ioSetup.inputs["Node"]=this.ioSetup.inputs._count++,this.addInput("Node")),this.blockDef.options.indexOf("nodeOutput")>-1&&(this.ioSetup.outputs["Node"]=this.ioSetup.outputs._count++,this.ioSetup.outputs["Prov"]=this.ioSetup.outputs._count++,this.addOutput("Node","Node"),this.addOutput("Prov",null)),this.blockDef.options.indexOf("fieldsOutputs")>-1){var e=!0,i=!1,n=void 0;try{for(var s,o=t.fields[Symbol.iterator]();!(e=(s=o.next()).done);e=!0){var r=s.value;this.ioSetup.outputs[r.path]=this.ioSetup.outputs._count++,this.addOutput(r.field)}}catch(d){i=!0,n=d}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}if(t.options.indexOf("fieldsInputs")>-1){var a=!0,l=!1,u=void 0;try{for(var h,p=t.fields[Symbol.iterator]();!(a=(h=p.next()).done);a=!0){var c=h.value;this.ioSetup.inputs[c.path]=this.ioSetup.inputs._count++,this.addInput(c.field)}}catch(d){l=!0,u=d}finally{try{a||null==p.return||p.return()}finally{if(l)throw u}}}this["WithInstanceRoot"]=this.addWidget("toggle","WithInstanceRoot",!0,(function(t){}),{on:"enabled",off:"disabled"}),this.serialize_widgets=!0,this.computeSize(),this.size=[this.size[0]+50,this.size[1]+30]};return e.title=t.collection,e.nodeType=t.collection,e},downloadGraph:function(){var t=this.graph.serialize(),e={models:null!=this.models?this.models:[],executionGraph:t,name:this.graphName,metadata:this.graphMetadata},i=new Blob([JSON.stringify(e)],{type:"text/plain;charset=utf-8",endings:"transparent"}),n="";this.graphMetadata&&null!=this.graphMetadata.title&&""!=this.graphMetadata.title?n+=this.graphMetadata.title:n+="currentGraph",this.graphMetadata&&null!=this.graphMetadata.version&&""!=this.graphMetadata.version&&(n+="-"+this.graphMetadata.version),Object(file_saver__WEBPACK_IMPORTED_MODULE_11__["saveAs"])(i,n+".json")},exportDHFModule:function(){var t=this.graph.serialize(),e={models:null!=this.models?this.models:[],executionGraph:t},i='const DataHub = require("/data-hub/5/datahub.sjs");\nvar gHelper  = require("/custom-modules/graphHelper")\nconst datahub = new DataHub();\n\n\nfunction getGraphDefinition() {\n\n  return ',n="}\n\nfunction main(content, options) {\n\n  //grab the doc id/uri\n  let id = content.uri;\n\n  //here we can grab and manipulate the context metadata attached to the document\n  let context = content.context;\n\n  //let's set our output format, so we know what we're exporting\n  let outputFormat = options.outputFormat ? options.outputFormat.toLowerCase() : datahub.flow.consts.DEFAULT_FORMAT;\n\n  //here we check to make sure we're not trying to push out a binary or text document, just xml or json\n  if (outputFormat !== datahub.flow.consts.JSON && outputFormat !== datahub.flow.consts.XML) {\n    datahub.debug.log({\n      message: 'The output format of type ' + outputFormat + ' is invalid. Valid options are ' + datahub.flow.consts.XML + ' or ' + datahub.flow.consts.JSON + '.',\n      type: 'error'\n    });\n    throw Error('The output format of type ' + outputFormat + ' is invalid. Valid options are ' + datahub.flow.consts.XML + ' or ' + datahub.flow.consts.JSON + '.');\n  }\n\n  /*\n  This scaffolding assumes we obtained the document from the database. If you are inserting information, you will\n  have to map data from the content.value appropriately and create an instance (object), headers (object), and triples\n  (array) instead of using the flowUtils functions to grab them from a document that was pulled from MarkLogic.\n  Also you do not have to check if the document exists as in the code below.\n\n  Example code for using data that was sent to MarkLogic server for the document\n  let instance = content.value;\n  let triples = [];\n  let headers = {};\n   */\n\n  //Here we check to make sure it's still there before operating on it\n  if (!fn.docAvailable(id)) {\n    datahub.debug.log({message: 'The document with the uri: ' + id + ' could not be found.', type: 'error'});\n    throw Error('The document with the uri: ' + id + ' could not be found.')\n  }\n\n  //grab the 'doc' from the content value space\n  let doc = content.value;\n\n  // let's just grab the root of the document if its a Document and not a type of Node (ObjectNode or XMLNode)\n  //if (doc && (doc instanceof Document || doc instanceof XMLDocument)) {\n  //  doc = fn.head(doc.root);\n  //}\n\n  /*\n  //get our instance, default shape of envelope is envelope/instance, else it'll return an empty object/array\n  let instance = datahub.flow.flowUtils.getInstance(doc) || {};\n\n  // get triples, return null if empty or cannot be found\n  let triples = datahub.flow.flowUtils.getTriples(doc) || [];\n\n  //gets headers, return null if cannot be found\n  let headers = datahub.flow.flowUtils.getHeaders(doc) || {};\n\n  //If you want to set attachments, uncomment here\n  // instance['$attachments'] = doc;\n  */\n\n\n\n  //insert code to manipulate the instance, triples, headers, uri, context metadata, etc.\n\n\n  let results = gHelper.executeGraphStep(doc,id,getGraphDefinition(),{collections: xdmp.documentGetCollections(id)})\n  return results;\n}\n\nmodule.exports = {\n  main: main\n};\n",s=new Blob([i+JSON.stringify(e)+n],{type:"text/plain;charset=utf-8",endings:"transparent"});Object(file_saver__WEBPACK_IMPORTED_MODULE_11__["saveAs"])(s,"main.sjs"),this.isExported=!0},saveCurrentGraph:function(){var t=this,e=this.graph.serialize(),i={models:null!=this.models?this.models:[],executionGraph:e,name:this.graphName,metadata:this.graphMetadata};this.$axios.post("/v1/resources/vppBackendServices?rs:action=SaveGraph",i).then((function(e){t.$q.notify({color:"positive",position:"top",message:"Current graph is saved",icon:"code"})})).catch((function(){t.$q.notify({color:"negative",position:"top",message:"Current graph save failed",icon:"report_problem"})}))},resetDhfDefaultGraph:function(){var t=this;this.$axios.get("/statics/graph/dhfDefaultGraph.json").then((function(e){var i=e.data;i.models=t.models,t.loadGraphFromJson(i)}))},executeGraph:function(){var t=this,e="";null!=this.selectedDB&&""!=this.selectedDB&&(e+="&rs:database="+this.selectedDB.value),this.saveToDB&&(e+=""!=e?"&rs:toDatabase="+this.selectedTargetDB.value+"&rs:save=true":"?rs:toDatabase="+this.selectedTargetDB.value+"&rs:save=true");var i=this.graph.serialize(),n={jsonGraph:{models:null!=this.models?this.models:[],executionGraph:i},collection:this.collectionForPreview.value,collectionRandom:this.randomDocPreview,previewUri:this.docUri};console.log(i),this.$axios.post("/v1/resources/vppBackendServices?rs:action=ExecuteGraph"+e,n).then((function(e){t.jsonFromPreview=e.data}))},saveGraph:function(t){this.savePopUpOpened=!0},loadGraph:function(t){this.loadSavedGraph(),this.loadPopUpOpened=!0},selectNode:function(t){console.log(t);var e=null;t.properties.testCases&&(e="Double click the box to edit the test cases"),t.properties.mapping&&(e="Double click the box to edit the mapping rules"),t.properties.ctsQuery&&(e="Double click the box to edit the lookup query"),null!=e&&this.$q.notify({color:"secondary",position:"center",message:e,icon:"info",timeout:800})},discoverDatabases:function(){var t=this;this.$axios.get("/v1/resources/vppBackendServices?rs:action=databasesDetails").then((function(e){t.availableDB=e.data,t.$axios.get("/statics/library/core.json").then((function(e){t.registerBlocksByConf(e.data,litegraph_js__WEBPACK_IMPORTED_MODULE_10__["LiteGraph"])})),t.$axios.get("/statics/library/user.json").then((function(e){t.registerBlocksByConf(e.data,litegraph_js__WEBPACK_IMPORTED_MODULE_10__["LiteGraph"])})),console.log("emit init"),t.$root.$emit("initGraphMetadata",t.graphMetadata),t.discoverCollections()})).catch((function(){t.$q.notify({color:"negative",position:"top",message:"Loading failed",icon:"report_problem"})}))}},_Users_epoilvet_dev_projects_visual_programming_plugin_node_modules_babel_runtime_corejs2_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()(_methods,"discoverCollections",(function(){var t=this,e="";null!=this.selectedDB&&""!=this.selectedDB&&(e+="&rs:database="+this.selectedDB.value),this.$axios.get("/v1/resources/vppBackendServices?rs:action=collectionDetails"+e).then((function(e){t.availableCollections=e.data})).catch((function(){t.$q.notify({color:"negative",position:"top",message:"Loading failed",icon:"report_problem"})}))})),_Users_epoilvet_dev_projects_visual_programming_plugin_node_modules_babel_runtime_corejs2_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()(_methods,"DblClickNode",(function(t){t.node_over&&t.node_over.properties&&t.node_over.properties.mapping&&(null!=t.node_over.properties&&(this.currentProperties=t.node_over.properties.mapping),this.editJson=!0),t.node_over&&t.node_over.properties&&t.node_over.properties.ctsQuery&&(null!=t.node_over.properties&&(this.currentCtsQuery=t.node_over.properties),this.editQuery=!0),t.node_over&&t.node_over.properties&&t.node_over.properties.testCases&&(null!=t.node_over.properties&&(this.currentCases=t.node_over.properties.testCases),this.editCases=!0)})),_Users_epoilvet_dev_projects_visual_programming_plugin_node_modules_babel_runtime_corejs2_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()(_methods,"setCurrrentDatabase",(function(t){this.selectedDB=t.selectedDatabase,this.availableDB=t.availableDatabases,this.discoverCollections()})),_Users_epoilvet_dev_projects_visual_programming_plugin_node_modules_babel_runtime_corejs2_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()(_methods,"registerBlocksByConf",(function registerBlocksByConf(configs,LiteGraph){var code="",_iteratorNormalCompletion6=!0,_didIteratorError6=!1,_iteratorError6=void 0;try{for(var _iterator6=configs[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=!0){var config=_step6.value;code+="function "+config.functionName+"(){",code+=config.inputs.map((function(t){return"this.addInput('"+t.name+("ee"==t.type?"','"+t.type+"');":"');")})).join(""),code+=config.outputs.map((function(t){return"this.addOutput('"+t.name+("ee"==t.type?"','"+t.type+"');":"');")})).join(""),code+=null!=config.properties?config.properties.map((function(t){return"this.addProperty('"+t.name+(t.type?"',"+JSON.stringify(t.type)+");":"');")})).join(""):"",code+=null!=config.widgets?config.widgets.map((function(t){return"this.addWidget('"+t.type+"','"+t.name+"','"+t.default+"', function(v){"+(t.callback?t.callback:"")+"}.bind(this), { values:"+JSON.stringify(t.values)+"} );"})).join(""):"",config.width&&(code+="    this.size = ["+config.width+","+config.height+"];\n"),code+="    this.serialize_widgets = true;",code+="};",code+=config.functionName+".title = '"+config.blockName+"';",code+=config.functionName+'.prototype.notify = function(node){this.$root.$emit("nodeSelected",node)}.bind(this);',code+=config.functionName+".prototype.onSelected = function(){this.notify(this) };",code+=config.functionName+'.prototype.onDblClick = function(e,pos,object){this.$root.$emit("nodeDblClicked",object) }.bind(this);',code+=config.functionName+".prototype.onExecute = function(){  ",null!=config.function&&null!=config.function.ref?function(){var t=0;code+="this.setOutputData( 0, "+config.function.ref+"("+config.inputs.map((function(e){return"this.getInputData("+t+++")"})).join(",")+"));"}():code+=config.function.code,code+="};",code+="LiteGraph.registerNodeType('"+config.library+"/"+config.blockName+"', "+config.functionName+" );"}}catch(err){_didIteratorError6=!0,_iteratorError6=err}finally{try{_iteratorNormalCompletion6||null==_iterator6.return||_iterator6.return()}finally{if(_didIteratorError6)throw _iteratorError6}}eval(code)})),_methods),created:function(){},mounted:function(){console.log("mounted"),this.$root.$on("csvLoadingRequested",this.createGraphFromMapping),this.$root.$on("registerModel",this.registerModel),this.$root.$on("executeGraphCall",function(){this.showPreview=!0}.bind(this)),this.$root.$on("databaseChanged",this.setCurrrentDatabase),this.$root.$on("saveGraphCall",this.saveGraph),this.$root.$on("downloadGraphCall",this.downloadGraph),this.$root.$on("loadGraphCall",this.loadGraph),this.$root.$on("loadGraphJsonCall",this.loadGraphFromJson),this.$root.$on("exportGraphCall",this.exportDHFModule),this.$root.$on("nodeDblClicked",this.DblClickNode),this.$root.$on("nodeSelected",this.selectNode),this.$root.$on("loadDHFDefaultGraphCall",this.resetDhfDefaultGraph),this.discoverDatabases(),this.graph=new litegraph_js__WEBPACK_IMPORTED_MODULE_10__["LiteGraph"].LGraph,this.graph_canvas=new litegraph_js__WEBPACK_IMPORTED_MODULE_10__["LiteGraph"].LGraphCanvas(this.$refs["mycanvas"],this.graph)}},"created",(function(){this.$root.$on("blockRequested",this.createBlock)}))}}]);